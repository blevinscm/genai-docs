
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://blevinscm.github.com/genai-docs/learn/prompts/Optimize-promptsbookmark_borderbookmark/">
      
      
        <link rel="prev" href="../../../models/Evaluate-Gen-AI-agents/">
      
      
        <link rel="next" href="../../../Retrieval-and-ranking/">
      
      
      <link rel="icon" href="../../../assets/google-cloud-vertex-ai.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>Optimize Promptsbookmark_borderbookmark - Vertex Generative AI</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Google+Sans:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Google Sans";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../stylesheets/extra.css">
    
      <link rel="stylesheet" href="../../../js/chat-widget/chat-widget.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="light-blue">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#optimize-prompts-bookmark_borderbookmark" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Vertex Generative AI" class="md-header__button md-logo" aria-label="Vertex Generative AI" data-md-component="logo">
      
  <img src="../../../assets/google-cloud-vertex-ai.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Vertex Generative AI
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Optimize Promptsbookmark_borderbookmark
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="light-blue"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="light-blue"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/blevinscm/genai-docs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../Generative-AI-on-Vertex-AI-Cookbook/" class="md-tabs__link">
          
  
  
    
  
  Learn

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../agent-engine/Set-up-the-environment/" class="md-tabs__link">
          
  
  
    
  
  Build

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../models/Introduction-to-tuning/" class="md-tabs__link">
          
  
  
    
  
  Tune

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../deploy/Deploy-generative-AI-models/" class="md-tabs__link">
          
  
  
    
  
  Deploy

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../agent-engine/manage/Manage-deployed-agents/" class="md-tabs__link">
          
  
  
    
  
  Manage

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../../models/evaluation-overview/" class="md-tabs__link">
          
  
  
    
  
  Optimize

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Vertex Generative AI" class="md-nav__button md-logo" aria-label="Vertex Generative AI" data-md-component="logo">
      
  <img src="../../../assets/google-cloud-vertex-ai.png" alt="logo">

    </a>
    Vertex Generative AI
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/blevinscm/genai-docs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Learn
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Learn
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Generative-AI-on-Vertex-AI-Cookbook/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Vertex AI Generative AI Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Generative-AI-glossary/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Glossary
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Generative-AI-on-Vertex-AI-release-notes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Release Notes
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../supported-models_1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Supported Models Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../model-reference/gemini/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Gemini Models Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../image/Imagen-on-Vertex-AI/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Imagen Models Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../code/code-models-overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Code Models Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../intelligent-code-commenter/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Intelligent Code Commenter
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../open-models/Use-Gemma-open-models/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Open Models (Gemma, Llama)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../partner-models/use-partner-models/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Partner Models (Claude, AI21)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Introduction-to-prompting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introduction to Prompting
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Overview-of-prompting-strategies/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Prompting Strategies
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../multimodal/Design-multimodal-prompts/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Multimodal Concepts
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../embeddings/Choose-an-embeddings-task-type/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Embeddings Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../multimodal/Introduction-to-function-calling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Function Calling Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../grounding/Ground-responses-using-RAG/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Grounding Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../agent-builder/Vertex-AI-Agent-Builder-overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Agent Builder Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../agent-engine/Vertex-AI-Agent-Engine-overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Agent Engine Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../rag-engine/Vertex-AI-RAG-Engine-overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    RAG Engine Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../context-cache/Context-caching-overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Context Caching Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../extensions/Extensions-overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Extensions Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../example-store/Example-Store-overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Example Store Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Generative-AI-and-data-governance/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Data Governance
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Security-controls-for-Generative-AI/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Security & Safety
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../deprecations/Model-versions-and-lifecycle/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Deprecations & Lifecycle
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../getting-help_1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Getting Help
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Build
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Build
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../agent-engine/Set-up-the-environment/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Set up Environment (Agent Engine)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../agent-engine/develop/Develop-a-LangChain-agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Develop LangChain Agent
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../agent-engine/develop/Develop-an-Agent-Development-Kit-agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Develop ADK Agent
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../agent-engine/use/Use-a-LangChain-agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Use LangChain Agent
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../agent-engine/use/Use-a-LangGraph-agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Use LangGraph Agent
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../chat/Design-chat-prompts/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Design Chat Prompts
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../multimodal/Text-generationbookmark_borderbookmark/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Generate Text with Gemini
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../image/Generate-images-using-text-prompts/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Generate Images with Imagen
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Generate-images-with-Gemini/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Generate Images with Gemini
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../video/generate-videos/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Generate Video with Veo
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../embeddings/Get-batch-text-embeddings-predictions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Get Text Embeddings
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../embeddings/Get-multimodal-embeddings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Get Multimodal Embeddings
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../model-reference/Function-calling-reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Use Function Calling
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../grounding/Use-Google-Search-suggestions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Use Grounding (Google Search)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../grounding/Grounding-with-your-data/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Use Grounding (Your Data)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../rag-engine/Use-data-ingestion-with-Vertex-AI-RAG-Engine/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Build with RAG Engine (Data Ingestion)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../rag-engine/use-vertexai-vector-search/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Build with RAG Engine (Vector Search)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Use-a-Weaviate-database-with-Vertex-AI-RAG-Engine/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Build with RAG Engine (Weaviate)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../context-cache/Create-a-context-cache/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Create Context Cache
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../extensions/Create-and-run-extensions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Create Extensions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../example-store/Retrieve-examples/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Use Example Store
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../multimodal/audio-understanding/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Multimodal Audio Understanding
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../multimodal/Document-understanding/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Multimodal Document Understanding
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../multimodal/Video-understanding/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Multimodal Video Understanding
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../prompt-gallery/samples/summarize_summarize_video/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Prompt Gallery Samples
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Tune
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Tune
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../models/Introduction-to-tuning/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introduction to Model Tuning
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../models/About-supervised-fine-tuning-for-Gemini-models/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tune Gemini Models (Supervised)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../models/gemini-supervised-tuning-prepare/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Prepare Data for Gemini SFT
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../models/tune_gemini/text_tune/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tune Gemini for Text
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../image/Style-customization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tune Imagen Models (Style/Subject)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../models/Tune-function-calling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tune Function Calling
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../model-garden/LoRA-and-QLoRA-recommendations-for-LLMs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    LoRA & QLoRA Recommendations
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Fine-tune-RAG-transformations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Fine-tune RAG Transformations
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Deploy
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Deploy
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../deploy/Deploy-generative-AI-models/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Deploy Generative AI Models
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../agent-engine/deploy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Deploy Agent (Agent Engine)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../models/Deployments-and-endpoints/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Deployments and Endpoints
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../model-garden/Use-models-in-Model-Garden/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Use Models from Model Garden
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Purchase-Provisioned-Throughput/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Purchase Provisioned Throughput
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Use-Provisioned-Throughput/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Use Provisioned Throughput
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../migrate/Migrate-to-the-Gemini-API-from-Azure-OpenAI/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Migrate from Azure OpenAI
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../migrate/openai/Using-OpenAI-libraries-with-Vertex-AI/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Use OpenAI Libraries with Vertex AI
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Manage
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Manage
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../agent-engine/manage/Manage-deployed-agents/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Manage Deployed Agents
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../agent-engine/manage/logging/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Agent Logging
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../agent-engine/manage/monitoring/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Agent Monitoring
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../agent-engine/sessions/Manage-sessions-using-direct-API-calls/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Manage Agent Sessions (API)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../agent-engine/sessions/Manage-sessions-with-Agent-Development-Kit/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Manage Agent Sessions (ADK)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../context-cache/Get-information-about-a-context-cache/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Manage Context Cache (Get/Delete)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Manage-your-RAG-knowledge-base-corpus/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Manage RAG Corpus
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Model-monitoring-metrics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Model Monitoring Metrics
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../quotas/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quotas & Limits
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../agent-engine/troubleshooting/Troubleshoot-deploying-an-agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Troubleshoot Agent Deployment
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../agent-engine/troubleshooting/Troubleshoot-developing-an-agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Troubleshoot Agent Development
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" checked>
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Optimize
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Optimize
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../models/evaluation-overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Model Evaluation Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../models/Gen-AI-evaluation-service-overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Gen AI Evaluation Service
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../models/Run-AutoSxS-pipeline-to-perform-pairwise-model-based-evaluation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Run AutoSxS (Pairwise Evaluation)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../models/Evaluate-Gen-AI-agents/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Evaluate Agents
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Optimize Prompts
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Optimize Prompts
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prompt-optimization-example" class="md-nav__link">
    <span class="md-ellipsis">
      Prompt optimization example
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Prompt optimization example">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#system-instructions" class="md-nav__link">
    <span class="md-ellipsis">
      System instructions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prompt-template" class="md-nav__link">
    <span class="md-ellipsis">
      Prompt template
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sample-prompts" class="md-nav__link">
    <span class="md-ellipsis">
      Sample prompts
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-optimization-works" class="md-nav__link">
    <span class="md-ellipsis">
      How optimization works
    </span>
  </a>
  
    <nav class="md-nav" aria-label="How optimization works">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#optimized-system-instructions" class="md-nav__link">
    <span class="md-ellipsis">
      Optimized system instructions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#supported-models" class="md-nav__link">
    <span class="md-ellipsis">
      Supported models
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#supported-evaluation-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      Supported evaluation metrics
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#before-you-begin" class="md-nav__link">
    <span class="md-ellipsis">
      Before you begin
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#optimize-prompts" class="md-nav__link">
    <span class="md-ellipsis">
      Optimize prompts
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Optimize prompts">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-a-prompt-template-and-system-instructions" class="md-nav__link">
    <span class="md-ellipsis">
      Create a prompt template and system instructions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prepare-sample-prompts" class="md-nav__link">
    <span class="md-ellipsis">
      Prepare sample prompts
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#choose-an-evaluation-metric" class="md-nav__link">
    <span class="md-ellipsis">
      Choose an evaluation metric
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-a-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Create a configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-prompt-optimizer" class="md-nav__link">
    <span class="md-ellipsis">
      Run prompt optimizer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Run prompt optimizer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#response" class="md-nav__link">
    <span class="md-ellipsis">
      Response
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#analyze-results-and-iterate" class="md-nav__link">
    <span class="md-ellipsis">
      Analyze results and iterate
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#whats-next" class="md-nav__link">
    <span class="md-ellipsis">
      What's next
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Retrieval-and-ranking/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    RAG Retrieval and Ranking
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../model-reference/Vertex-AI-Model-Optimizer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Vertex AI Model Optimizer
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../provisioned-throughput/Calculate-Provisioned-Throughput-requirements/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Calculate Provisioned Throughput
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../model-reference/count-tokens/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Count Tokens
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../context-cache/Context-caching-overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Context Caching Overview
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prompt-optimization-example" class="md-nav__link">
    <span class="md-ellipsis">
      Prompt optimization example
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Prompt optimization example">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#system-instructions" class="md-nav__link">
    <span class="md-ellipsis">
      System instructions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prompt-template" class="md-nav__link">
    <span class="md-ellipsis">
      Prompt template
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sample-prompts" class="md-nav__link">
    <span class="md-ellipsis">
      Sample prompts
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-optimization-works" class="md-nav__link">
    <span class="md-ellipsis">
      How optimization works
    </span>
  </a>
  
    <nav class="md-nav" aria-label="How optimization works">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#optimized-system-instructions" class="md-nav__link">
    <span class="md-ellipsis">
      Optimized system instructions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#supported-models" class="md-nav__link">
    <span class="md-ellipsis">
      Supported models
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#supported-evaluation-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      Supported evaluation metrics
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#before-you-begin" class="md-nav__link">
    <span class="md-ellipsis">
      Before you begin
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#optimize-prompts" class="md-nav__link">
    <span class="md-ellipsis">
      Optimize prompts
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Optimize prompts">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-a-prompt-template-and-system-instructions" class="md-nav__link">
    <span class="md-ellipsis">
      Create a prompt template and system instructions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prepare-sample-prompts" class="md-nav__link">
    <span class="md-ellipsis">
      Prepare sample prompts
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#choose-an-evaluation-metric" class="md-nav__link">
    <span class="md-ellipsis">
      Choose an evaluation metric
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-a-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Create a configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-prompt-optimizer" class="md-nav__link">
    <span class="md-ellipsis">
      Run prompt optimizer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Run prompt optimizer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#response" class="md-nav__link">
    <span class="md-ellipsis">
      Response
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#analyze-results-and-iterate" class="md-nav__link">
    <span class="md-ellipsis">
      Analyze results and iterate
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#whats-next" class="md-nav__link">
    <span class="md-ellipsis">
      What's next
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
    <a href="https://github.com/blevinscm/genai-docs/edit/main/docs/learn/prompts/Optimize-promptsbookmark_borderbookmark.md" title="Edit this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75z"/></svg>
    </a>
  
  


<h1 id="optimize-prompts-bookmark_borderbookmark">Optimize prompts bookmark_borderbookmark<a class="headerlink" href="#optimize-prompts-bookmark_borderbookmark" title="Permanent link">&para;</a></h1>
<p>Release Notes</p>
<p><strong>Preview</strong></p>
<p>This product or feature is subject to the "Pre-GA Offerings Terms" in the General Service Terms section
of the <a href="https://cloud.google.com/terms/service-terms#1">Service Specific Terms</a>.
Pre-GA products and features are available "as is" and might have limited support.
For more information, see the
<a href="https://cloud.google.com/products#product-launch-stages">launch stage descriptions</a>.</p>
<p>This document describes how to use the Vertex AI prompt optimizer to
automatically optimize prompt performance by improving the
<a href="https://cloud.google.com/vertex-ai/generative-ai/docs/learn/prompts/system-instructions">system instructions</a> for
a set of prompts.</p>
<p>The Vertex AI prompt optimizer can help you improve your prompts
quickly at scale, without manually re-writing system instructions or
individual prompts. This is especially useful when you want to use system
instructions and prompts that were written for one model with a different model.</p>
<p>To see an example of optimizing prompts, run one of the following Jupyter
notebooks:</p>
<ul>
<li>Vertex AI prompt optimizer:
 <a href="https://colab.research.google.com/github/GoogleCloudPlatform/generative-ai/blob/main/gemini/prompts/prompt_optimizer/vertex_ai_prompt_optimizer_ui.ipynb">Open in Colab</a> |
 <a href="https://console.cloud.google.com/vertex-ai/colab/import/https%3A%2F%2Fraw.githubusercontent.com%2FGoogleCloudPlatform%2Fgenerative-ai%2Fmain%2Fgemini%2Fprompts%2Fprompt_optimizer%2Fvertex_ai_prompt_optimizer_ui.ipynb">Open in Colab Enterprise</a> |
 <a href="https://console.cloud.google.com/vertex-ai/workbench/deploy-notebook?download_url=https%3A%2F%2Fraw.githubusercontent.com%2FGoogleCloudPlatform%2Fgenerative-ai%2Fmain%2Fgemini%2Fprompts%2Fprompt_optimizer%2Fvertex_ai_prompt_optimizer_ui.ipynb">Open in Vertex AI Workbench user-managed notebooks</a> |
 <a href="https://github.com/GoogleCloudPlatform/generative-ai/blob/main/gemini/prompts/prompt_optimizer/vertex_ai_prompt_optimizer_ui.ipynb">View on GitHub</a></li>
<li>Vertex AI prompt optimizer SDK:
 <a href="https://colab.research.google.com/github/GoogleCloudPlatform/generative-ai/blob/main/gemini/prompts/prompt_optimizer/vertex_ai_prompt_optimizer_sdk.ipynb">Open in Colab</a> |
 <a href="https://console.cloud.google.com/vertex-ai/colab/import/https%3A%2F%2Fraw.githubusercontent.com%2FGoogleCloudPlatform%2Fgenerative-ai%2Fmain%2Fgemini%2Fprompts%2Fprompt_optimizer%2Fvertex_ai_prompt_optimizer_sdk.ipynb">Open in Colab Enterprise</a> |
 <a href="https://console.cloud.google.com/vertex-ai/workbench/deploy-notebook?download_url=https%3A%2F%2Fraw.githubusercontent.com%2FGoogleCloudPlatform%2Fgenerative-ai%2Fmain%2Fgemini%2Fprompts%2Fprompt_optimizer%2Fvertex_ai_prompt_optimizer_sdk.ipynb">Open in Vertex AI Workbench user-managed notebooks</a> |
 <a href="https://github.com/GoogleCloudPlatform/generative-ai/blob/main/gemini/prompts/prompt_optimizer/vertex_ai_prompt_optimizer_sdk.ipynb">View on GitHub</a></li>
<li>Vertex AI prompt optimizer custom metrics:
 <a href="https://colab.research.google.com/github/GoogleCloudPlatform/generative-ai/blob/main/gemini/prompts/prompt_optimizer/vertex_ai_prompt_optimizer_sdk_custom_metric.ipynb">Open in Colab</a> |
 <a href="https://console.cloud.google.com/vertex-ai/colab/import/https%3A%2F%2Fraw.githubusercontent.com%2FGoogleCloudPlatform%2Fgenerative-ai%2Fmain%2Fgemini%2Fprompts%2Fprompt_optimizer%2Fvertex_ai_prompt_optimizer_sdk_custom_metric.ipynb">Open in Colab Enterprise</a> |
 <a href="https://console.cloud.google.com/vertex-ai/workbench/deploy-notebook?download_url=https%3A%2F%2Fraw.githubusercontent.com%2FGoogleCloudPlatform%2Fgenerative-ai%2Fmain%2Fgemini%2Fprompts%2Fprompt_optimizer%2Fvertex_ai_prompt_optimizer_sdk_custom_metric.ipynb">Open in Vertex AI Workbench user-managed notebooks</a> |
 <a href="https://github.com/GoogleCloudPlatform/generative-ai/blob/main/gemini/prompts/prompt_optimizer/vertex_ai_prompt_optimizer_sdk_custom_metric.ipynb">View on GitHub</a></li>
</ul>
<p>The Vertex AI prompt optimizer helps improve prompts by evaluating the
model's response to sample prompts against specified
<a href="../../../models/determine-eval/">evaluation metric(s)</a>. To use the
Vertex AI prompt optimizer, you must have the following:</p>
<ul>
<li>A set of sample prompts</li>
<li>System instructions that are used by all your sample prompts</li>
<li>A prompt template that references your sample prompts</li>
</ul>
<h2 id="prompt-optimization-example">Prompt optimization example<a class="headerlink" href="#prompt-optimization-example" title="Permanent link">&para;</a></h2>
<p>For example, to optimize system instructions for a set of prompts that reference
contextual information to answer questions about cooking, you can use the
Vertex AI prompt optimizer. To complete this task, you would prepare
the inputs similar to the following:</p>
<h4 id="system-instructions">System instructions<a class="headerlink" href="#system-instructions" title="Permanent link">&para;</a></h4>
<div class="language-python highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">You</span> <span class="n">are</span> <span class="n">a</span> <span class="n">professional</span> <span class="n">chef</span><span class="o">.</span> <span class="n">Your</span> <span class="n">goal</span> <span class="ow">is</span> <span class="n">teaching</span> <span class="n">how</span> <span class="n">to</span> <span class="n">cook</span> <span class="n">healthy</span> <span class="n">cooking</span> <span class="n">recipes</span> <span class="n">to</span> <span class="n">your</span> <span class="n">apprentice</span><span class="o">.</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="n">Given</span> <span class="n">a</span> <span class="n">question</span> <span class="kn">from</span><span class="w"> </span><span class="nn">your</span> <span class="n">apprentice</span> <span class="ow">and</span> <span class="n">some</span> <span class="n">context</span><span class="p">,</span> <span class="n">provide</span> <span class="n">the</span> <span class="n">correct</span> <span class="n">answer</span> <span class="n">to</span> <span class="n">the</span> <span class="n">question</span><span class="o">.</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="n">Use</span> <span class="n">the</span> <span class="n">context</span> <span class="n">to</span> <span class="k">return</span> <span class="n">a</span> <span class="n">single</span> <span class="ow">and</span> <span class="n">correct</span> <span class="n">answer</span> <span class="k">with</span> <span class="n">some</span> <span class="n">explanation</span><span class="o">.</span>
</span></code></pre></div>
<h4 id="prompt-template">Prompt template<a class="headerlink" href="#prompt-template" title="Permanent link">&para;</a></h4>
<div class="language-python highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="n">Question</span><span class="p">:</span> <span class="p">{</span><span class="n">input_question</span><span class="p">}</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="n">Facts</span><span class="p">:</span> <span class="p">{</span><span class="n">input_context</span><span class="p">}</span>
</span></code></pre></div>
<h4 id="sample-prompts">Sample prompts<a class="headerlink" href="#sample-prompts" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th><code>input_question</code></th>
<th><code>input_context</code></th>
</tr>
</thead>
<tbody>
<tr>
<td>What are some techniques for cooking red meat and pork that maximize flavor and tenderness while minimizing the formation of unhealthy compounds?</td>
<td>Red meat and pork should be cooked to an internal temperature of 145 degrees fahrenheit (63 degrees celsius) to ensure safety. Marinating meat in acidic ingredients like lemon juice or vinegar can help tenderize it by breaking down tough muscle fibers. High-heat cooking methods like grilling and pan-searing can create delicious browning and caramelization, but it's important to avoid charring, which can produce harmful compounds.</td>
</tr>
<tr>
<td>What are some creative ways to add flavor and nutrition to protein shakes without using added sugars or artificial ingredients?</td>
<td>Adding leafy greens like spinach or kale is a great way to boost the nutritional value of your shake without drastically altering the flavor. Using unsweetened almond milk or coconut water instead of regular milk can add a subtle sweetness and a boost of healthy fats or electrolytes, respectively. Did you know that over-blending your shake can actually heat it up? To keep things cool and refreshing, blend for shorter bursts and give your blender a break if needed.</td>
</tr>
</tbody>
</table>
<h3 id="how-optimization-works">How optimization works<a class="headerlink" href="#how-optimization-works" title="Permanent link">&para;</a></h3>
<p>After preparing your inputs, you choose an <em>optimization mode</em>, <em>evaluation
metric</em>, and <em>target model</em>.</p>
<ul>
<li>Optimization mode: specifies whether the Vertex AI prompt
 optimizer optimizes the system instructions, selects sample prompts to add to
 the system instructions as few shot examples, or both.</li>
<li>Evaluation metric: the metric that the Vertex AI prompt optimizer
 uses to optimize the system instructions and/or select sample prompts.</li>
<li>Target model: the
 <a href="../../models/">Google model</a> that the
 Vertex AI prompt optimizer optimizes the system instructions and/or
 selects sample prompts for use with.</li>
</ul>
<p>When you run the Vertex AI prompt optimizer, it optimizes the system
instructions based on your selections by running a custom training job
where it iteratively evaluates your sample prompts and rewrites your system
instructions to find the version that produces the best evaluation score for
the target model.</p>
<p>At the end of the job, the Vertex AI prompt optimizer outputs the
optimized system instructions with their evaluation score.</p>
<h4 id="optimized-system-instructions">Optimized system instructions<a class="headerlink" href="#optimized-system-instructions" title="Permanent link">&para;</a></h4>
<div class="language-python highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="n">As</span> <span class="n">a</span> <span class="n">highly</span> <span class="n">skilled</span> <span class="n">chef</span> <span class="k">with</span> <span class="n">a</span> <span class="n">passion</span> <span class="k">for</span> <span class="n">healthy</span> <span class="n">cooking</span><span class="p">,</span> <span class="n">you</span> <span class="n">love</span> <span class="n">sharing</span> <span class="n">your</span> <span class="n">knowledge</span> <span class="k">with</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="n">aspiring</span> <span class="n">chefs</span><span class="o">.</span> <span class="n">Today</span><span class="p">,</span> <span class="n">a</span> <span class="n">culinary</span> <span class="n">intern</span> <span class="n">approaches</span> <span class="n">you</span> <span class="k">with</span> <span class="n">a</span> <span class="n">question</span> <span class="n">about</span> <span class="n">healthy</span> <span class="n">cooking</span><span class="o">.</span> <span class="n">Given</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="n">the</span> <span class="n">intern</span><span class="s1">&#39;s question and some facts, provide a clear, concise, and informative answer that will help</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="n">the</span> <span class="n">intern</span> <span class="n">excel</span> <span class="ow">in</span> <span class="n">their</span> <span class="n">culinary</span> <span class="n">journey</span><span class="o">.</span>
</span></code></pre></div>
<h2 id="supported-models">Supported models<a class="headerlink" href="#supported-models" title="Permanent link">&para;</a></h2>
<p>You can optimize system instructions for use with the following models:</p>
<ul>
<li><a href="../../models/">Gemini models</a></li>
<li><a href="https://cloud.google.com/vertex-ai/generative-ai/docs/multimodal/gemini-experimental">Gemini experimental models</a></li>
</ul>
<h2 id="supported-evaluation-metrics">Supported evaluation metrics<a class="headerlink" href="#supported-evaluation-metrics" title="Permanent link">&para;</a></h2>
<p>The Vertex AI prompt optimizer supports
custom evaluation metrics, and additionally supports the following evaluation
metrics:</p>
<table>
<thead>
<tr>
<th>Metric type</th>
<th>Use case</th>
<th>Metric</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="../../../models/determine-eval/">Model-based</a></td>
<td><a href="https://cloud.google.com/vertex-ai/generative-ai/docs/models/metrics-templates#pointwise_summarization">Summarization</a></td>
<td><code>summarization_quality</code></td>
<td>Describes the model's ability to answer questions given a body of text to reference.</td>
</tr>
<tr>
<td><a href="https://cloud.google.com/vertex-ai/generative-ai/docs/models/metrics-templates#pointwise_question_answering_quality">Question answering</a></td>
<td><code>question_answering_correctness</code>*</td>
<td>Describes the model's ability to correctly answer a question.</td>
<td></td>
</tr>
<tr>
<td><code>question_answering_quality</code></td>
<td>Describes the model's ability to answer questions given a body of text to reference.</td>
<td></td>
<td></td>
</tr>
<tr>
<td><a href="https://cloud.google.com/vertex-ai/generative-ai/docs/models/metrics-templates#pointwise_coherence">Coherence</a></td>
<td><code>coherence</code></td>
<td>Describes the model's ability to provide a coherent response and measures how well the generated text flows logically and makes sense.</td>
<td></td>
</tr>
<tr>
<td><a href="https://cloud.google.com/vertex-ai/generative-ai/docs/models/metrics-templates#pointwise_safety">Safety</a></td>
<td><code>safety</code></td>
<td>Describes the model's level of safety, that is, whether the response contains any unsafe text.</td>
<td></td>
</tr>
<tr>
<td><a href="https://cloud.google.com/vertex-ai/generative-ai/docs/models/metrics-templates#pointwise_fluency">Fluency</a></td>
<td><code>fluency</code></td>
<td>Describes the model's language mastery.</td>
<td></td>
</tr>
<tr>
<td><a href="https://cloud.google.com/vertex-ai/generative-ai/docs/models/metrics-templates#pointwise_groundedness">Groundedness</a></td>
<td><code>groundedness</code></td>
<td>Describes the model's ability to provide or reference information included only in the input text.</td>
<td></td>
</tr>
<tr>
<td><a href="../../../models/evaluation-overview/">Computation-based</a></td>
<td><a href="../../../models/determine-eval/">Tool use and function calling</a></td>
<td><code>tool_call_valid</code>*</td>
<td>Describes the model's ability to predict a valid tool call.</td>
</tr>
<tr>
<td><code>tool_name_match</code>*</td>
<td>Describes the model's ability to predict a tool call with the correct tool name. Only the first tool call is inspected.</td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>tool_parameter_key_match</code>*</td>
<td>Describes the model's ability to predict a tool call with the correct parameter names.</td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>tool_parameter_kv_match</code>*</td>
<td>Describes the model's ability to predict a tool call with the correct parameter names and key values.</td>
<td></td>
<td></td>
</tr>
<tr>
<td><a href="../../../models/determine-eval/">General text generation</a></td>
<td><code>bleu</code>*</td>
<td>Holds the result of an algorithm for evaluating the quality of the prediction, which has been translated from one natural language to another natural language. The quality of the prediction is considered to be the correspondence between a prediction parameter and its reference parameter.</td>
<td></td>
</tr>
<tr>
<td><code>exact_match</code>*</td>
<td>Computes whether a prediction parameter matches a reference parameter exactly.</td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>rouge_1</code>*</td>
<td>Used to compare the provided prediction parameter against a reference parameter.</td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>rouge_2</code>*</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>rouge_l</code>*</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>rouge_l_sum</code>*</td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>* If you want to optimize your prompts using the
<code>question_answering_correctness</code> or computation-based evaluations, you must do
one of the following:</p>
<ul>
<li>Add a variable that represents the ground truth response for your prompts to
 your <a href="#template-si">prompt template</a>.</li>
<li>If you don't have ground truth responses for your prompts, but you previously
 used the prompts with a <a href="../../models/">Google model</a> and
 achieved your targeted results, you can add the <code>source_model</code> parameter to
 your <a href="#configuration">configuration</a> instead of adding ground truth responses.
 When the <code>source_model</code> parameter is set, the Vertex AI runs your
 sample prompts on the source model to generate the ground truth responses for
 you.</li>
</ul>
<h2 id="before-you-begin">Before you begin<a class="headerlink" href="#before-you-begin" title="Permanent link">&para;</a></h2>
<p>To ensure that the <a href="https://cloud.google.com/iam/docs/service-account-types#default">Compute Engine default service account</a> has the necessary
permissions to optimize prompts,
ask your administrator to grant the <a href="https://cloud.google.com/iam/docs/service-account-types#default">Compute Engine default service account</a> the
following IAM roles on the project:</p>
<p><strong>Important:</strong> You must grant these roles
to the <a href="https://cloud.google.com/iam/docs/service-account-types#default">Compute Engine default service account</a>, <em>not</em> to your user account. Failure to grant the roles to the correct principal might result in permission errors.</p>
<ul>
<li><a href="https://cloud.google.com/iam/docs/understanding-roles#aiplatform.user">Vertex AI User</a> (<code>roles/aiplatform.user</code>)</li>
<li><a href="https://cloud.google.com/iam/docs/understanding-roles#storage.objectAdmin">Storage Object Admin</a> (<code>roles/storage.objectAdmin</code>)</li>
<li><a href="https://cloud.google.com/iam/docs/understanding-roles#artifactregistry.reader">Artifact Registry Reader</a> (<code>roles/artifactregistry.reader</code>)</li>
</ul>
<p>For more information about granting roles, see <a href="https://cloud.google.com/iam/docs/granting-changing-revoking-access">Manage access to projects, folders, and organizations</a>.</p>
<p>Your administrator might also be able to give the <a href="https://cloud.google.com/iam/docs/service-account-types#default">Compute Engine default service account</a>
the required permissions through <a href="https://cloud.google.com/iam/docs/creating-custom-roles">custom
roles</a> or other <a href="https://cloud.google.com/iam/docs/understanding-roles">predefined
roles</a>.</p>
<h2 id="optimize-prompts">Optimize prompts<a class="headerlink" href="#optimize-prompts" title="Permanent link">&para;</a></h2>
<p>You can optimize prompts by running the
<a href="https://console.cloud.google.com/vertex-ai/colab/import/https:%2F%2Fraw.githubusercontent.com%2FGoogleCloudPlatform%2Fgenerative-ai%2Fmain%2Fgemini%2Fprompts%2Fprompt_optimizer%2Fvertex_ai_prompt_optimizer_ui.ipynb">Vertex AI prompt optimizer notebook</a>,
or by using the Vertex AI API. To optimize prompts, choose which method
you want to use to run the Vertex AI prompt optimizer, then complete
the steps as described in detail in the following sections:</p>
<p><strong>Tip:</strong> We recommend running the
Vertex AI prompt optimizer notebook for first time users. The notebook
provides a more interactive experience than the Vertex AI API.</p>
<ol>
<li><a href="#template-si">Create a prompt template and system instructions</a></li>
<li><a href="#prepare-sample-prompts">Prepare sample prompts</a></li>
<li><a href="#evaluation-metric">Choose an evaluation metric</a></li>
<li><a href="#configuration">Create a configuration</a></li>
<li><a href="#run-prompt-optimizer">Run the prompt optimization job</a></li>
<li><a href="#anaylyze-iterate">Analyze results and iterate</a></li>
</ol>
<h3 id="create-a-prompt-template-and-system-instructions">Create a prompt template and system instructions<a class="headerlink" href="#create-a-prompt-template-and-system-instructions" title="Permanent link">&para;</a></h3>
<p>Prompt templates define the format of all of your prompts through replaceable
variables. When you use a prompt template to optimize prompts, the
variables are replaced by the data in the prompt dataset.</p>
<p>Prompt template variables must meet the following requirements:</p>
<ul>
<li>Variables must be wrapped in curly-braces</li>
<li>Variable names must not contain spaces</li>
<li>Variables that represent multimodal inputs must include the <code>MIME_TYPE</code> string
 after the variable:</li>
</ul>
<div class="language-python highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="o">@@</span><span class="nd">@MIME_TYPE</span>
</span></code></pre></div>
<p>Replace <code>MIME_TYPE</code> with an
 <a href="https://cloud.google.com/vertex-ai/generative-ai/docs/multimodal/image-understanding#image-requirements">image</a>,
 <a href="https://cloud.google.com/vertex-ai/generative-ai/docs/multimodal/video-understanding#video-requirements">video</a>,
 <a href="../../../multimodal/audio-understanding/">audio</a>,
 or
 <a href="https://cloud.google.com/vertex-ai/generative-ai/docs/multimodal/document-understanding#document-requirements">document</a>
 MIME type that is supported by the target model.</p>
<p>Create a prompt template and system instructions using one of the following
methods:</p>
<p><a href="#notebook">Notebook</a> <a href="#sdk">SDK</a> 
More</p>
<p>If you want to run the Vertex AI prompt optimizer through the
notebook, create system instructions and a prompt template by doing the
following:</p>
<ol>
<li>In Colab Enterprise, open the Vertex AI prompt
 optimizer notebook.</li>
</ol>
<p><a href="https://console.cloud.google.com/vertex-ai/colab/import/https:%2F%2Fraw.githubusercontent.com%2FGoogleCloudPlatform%2Fgenerative-ai%2Fmain%2Fgemini%2Fprompts%2Fprompt_optimizer%2Fvertex_ai_prompt_optimizer_ui.ipynb">Go to Vertex AI prompt optimizer notebook</a>
2. In the <strong>Create a prompt template and system instructions</strong> section, do
 the following:</p>
<ol>
<li>In the <strong>SYSTEM_INSTRUCTION</strong> field, enter your system instructions.
 For example:</li>
</ol>
<p><div class="language-python highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="n">Based</span> <span class="n">on</span> <span class="n">the</span> <span class="n">following</span> <span class="n">images</span> <span class="ow">and</span> <span class="n">articles</span> <span class="n">respond</span> <span class="n">to</span> <span class="n">the</span> <span class="n">questions</span><span class="o">.</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="n">Be</span> <span class="n">concise</span><span class="p">,</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="ow">and</span> <span class="n">answer</span> \<span class="s2">&quot;I don&#39;t know</span><span class="se">\&quot;</span><span class="s2"> if the response cannot be found in the provided articles or images.</span>
</span></code></pre></div>
 2. In the <strong>PROMPT_TEMPLATE</strong> field, enter your prompt template. For
 example:</p>
<p><div class="language-python highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="n">Article</span> <span class="mi">1</span><span class="p">:</span>\<span class="n">n</span>\<span class="n">n</span><span class="p">{</span><span class="n">article_1</span><span class="p">}</span>\<span class="n">n</span>\<span class="n">nImage</span> <span class="mi">1</span><span class="p">:</span>\<span class="n">n</span>\<span class="n">n</span><span class="p">{</span><span class="n">image_1</span><span class="p">}</span> <span class="o">@@</span><span class="nd">@image</span><span class="o">/</span><span class="n">jpeg</span>\<span class="n">n</span>\<span class="n">nQuestion</span><span class="p">:</span> <span class="p">{</span><span class="n">question</span><span class="p">}</span>
</span></code></pre></div>
 3. If you want to optimize your prompts using the
 <code>question_answering_correctness</code> or computation-based evaluations, you
 must do one of the following:
 - Add the <code>{target}</code> variable to the prompt
 template, to represent the prompt's ground truth response. For example:</p>
<p><div class="language-python highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="n">Article</span> <span class="mi">1</span><span class="p">:</span>\<span class="n">n</span>\<span class="n">n</span><span class="p">{</span><span class="n">article_1</span><span class="p">}</span>\<span class="n">n</span>\<span class="n">nImage</span> <span class="mi">1</span><span class="p">:</span>\<span class="n">n</span>\<span class="n">n</span><span class="p">{</span><span class="n">image_1</span><span class="p">}</span> <span class="o">@@</span><span class="nd">@image</span><span class="o">/</span><span class="n">jpeg</span>\<span class="n">n</span>\<span class="n">nQuestion</span><span class="p">:</span> <span class="p">{</span><span class="n">question</span><span class="p">}</span>\<span class="n">n</span>\<span class="n">n</span> <span class="n">Answer</span><span class="p">:</span> <span class="p">{</span><span class="n">target</span><span class="p">}</span>
</span></code></pre></div>
 - If you don't have ground truth responses for your prompts, but you
 previously used the prompts with a
 <a href="../../models/">Google model</a> and achieved your
 targeted results, you can add the <code>source_model</code> parameter to your
 <a href="#configuration">configuration</a> instead of adding ground truth
 responses. When the <code>source_model</code> parameter is set, the
 Vertex AI prompt optimizer runs your sample prompts on the
 source model to generate the ground truth responses for you.</p>
<p>If you want to run the Vertex AI prompt optimizer through the SDK
without using the notebook, create text files for your prompt template and
system instructions by doing the following:</p>
<ol>
<li>Create a text file for your system instructions.</li>
<li>In the text file, define your system instructions to the text file. For
 example:</li>
</ol>
<p><div class="language-python highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="n">Based</span> <span class="n">on</span> <span class="n">the</span> <span class="n">following</span> <span class="n">images</span> <span class="ow">and</span> <span class="n">articles</span> <span class="n">respond</span> <span class="n">to</span> <span class="n">the</span> <span class="n">questions</span><span class="o">.</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="n">Be</span> <span class="n">concise</span><span class="p">,</span> <span class="ow">and</span> <span class="n">answer</span> \<span class="s2">&quot;I don&#39;t know</span><span class="se">\&quot;</span><span class="s2"> if the response cannot be found in the provided articles or images.</span>
</span></code></pre></div>
3. Create a text file for your prompt template.
4. In the text file, define a prompt template that includes one or more
 variables. For example:</p>
<p><div class="language-python highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="n">Article</span> <span class="mi">1</span><span class="p">:</span>\<span class="n">n</span>\<span class="n">n</span><span class="p">{</span><span class="n">article_1</span><span class="p">}</span>\<span class="n">n</span>\<span class="n">nImage</span> <span class="mi">1</span><span class="p">:</span>\<span class="n">n</span>\<span class="n">n</span><span class="p">{</span><span class="n">image_1</span><span class="p">}</span> <span class="o">@@</span><span class="nd">@image</span><span class="o">/</span><span class="n">jpeg</span>\<span class="n">n</span>\<span class="n">nQuestion</span><span class="p">:</span> <span class="p">{</span><span class="n">question</span><span class="p">}</span>
</span></code></pre></div>
5. If you want to optimize your prompts using the
 <code>question_answering_correctness</code> or computation-based evaluations, you
 must do one of the following:</p>
<ul>
<li>Add the <code>{target}</code> variable to the prompt
 template, to represent the prompt's ground truth response. For example:</li>
</ul>
<p><div class="language-python highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="n">Article</span> <span class="mi">1</span><span class="p">:</span>\<span class="n">n</span>\<span class="n">n</span><span class="p">{</span><span class="n">article_1</span><span class="p">}</span>\<span class="n">n</span>\<span class="n">nImage</span> <span class="mi">1</span><span class="p">:</span>\<span class="n">n</span>\<span class="n">n</span><span class="p">{</span><span class="n">image_1</span><span class="p">}</span> <span class="o">@@</span><span class="nd">@image</span><span class="o">/</span><span class="n">jpeg</span>\<span class="n">n</span>\<span class="n">nQuestion</span><span class="p">:</span> <span class="p">{</span><span class="n">question</span><span class="p">}</span>\<span class="n">n</span>\<span class="n">n</span> <span class="n">Answer</span><span class="p">:</span> <span class="p">{</span><span class="n">target</span><span class="p">}</span>
</span></code></pre></div>
 - If you don't have ground truth responses for your prompts, but you
 previously used the prompts with a
 <a href="../../models/">Google model</a> and achieved your
 targeted results, you can add the <code>source_model</code> parameter to your
 <a href="#configuration">configuration</a> instead of adding ground truth
 responses. When the <code>source_model</code> parameter is set, the
 Vertex AI prompt optimizer runs your sample prompts on the
 source model to generate the ground truth responses for you.</p>
<h3 id="prepare-sample-prompts">Prepare sample prompts<a class="headerlink" href="#prepare-sample-prompts" title="Permanent link">&para;</a></h3>
<p>To get the best results from the Vertex AI prompt optimizer, use
50-100 sample prompts.</p>
<ul>
<li>The tool can still be effective with as few as 5 sample prompts.</li>
<li>The best samples include examples where the target model performs poorly.</li>
</ul>
<p><strong>Note:</strong> The Vertex AI prompt optimizer's performance improves as you
increase the number of sample prompts. If you notice poor performance for your
set of sample prompts, consider adding more prompts and re-running the tool.</p>
<p>The sample prompts contain the data that replaces the variables in the prompt
template. You can use a JSONL or CSV file to store your sample prompts.</p>
<p><a href="#jsonl-file">JSONL file</a> <a href="#csv-file">CSV file</a> 
More</p>
<ol>
<li>Create a JSONL file.</li>
<li>In the JSONL file, add the prompt data that replaces each variable. For
 example:</li>
</ol>
<p><div class="language-python highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="p">{</span><span class="s2">&quot;article_1&quot;</span><span class="p">:</span> <span class="s2">&quot;The marine life &quot;</span><span class="p">,</span> <span class="s2">&quot;image_1&quot;</span><span class="p">:</span> <span class="s2">&quot;gs://path_to_image&quot;</span><span class="p">,</span> <span class="s2">&quot;Question&quot;</span><span class="p">:</span> <span class="s2">&quot;What are some most effective ways to reduce ocean pollution?&quot;</span><span class="p">,</span> <span class="s2">&quot;target&quot;</span><span class="p">:</span> <span class="s2">&quot;The articles and images don&#39;t answer this question.&quot;</span><span class="p">}</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="p">{</span><span class="s2">&quot;article_1&quot;</span><span class="p">:</span> <span class="s2">&quot;During the year &quot;</span><span class="p">,</span> <span class="s2">&quot;image_1&quot;</span><span class="p">:</span> <span class="s2">&quot;gs://path_to_image&quot;</span><span class="p">,</span> <span class="s2">&quot;Question&quot;</span><span class="p">:</span> <span class="s2">&quot;Who was the president in 2023?&quot;</span><span class="p">,</span> <span class="s2">&quot;target&quot;</span><span class="p">:</span> <span class="s2">&quot;Joe Biden&quot;</span><span class="p">}</span>
</span></code></pre></div>
3. <a href="https://cloud.google.com/storage/docs/uploading-objects">Upload the JSONL file to a Cloud Storage bucket</a>.</p>
<ol>
<li>Create a CSV file.</li>
<li>In the first row, add the variables from your prompt template.</li>
<li>In the following rows, add the sample data that replaces each variable.</li>
<li><a href="https://cloud.google.com/storage/docs/uploading-objects">Upload the CSV file to a Cloud Storage bucket</a>.</li>
</ol>
<h3 id="choose-an-evaluation-metric">Choose an evaluation metric<a class="headerlink" href="#choose-an-evaluation-metric" title="Permanent link">&para;</a></h3>
<p>The Vertex AI prompt optimizer uses evaluation metrics to optimize
system instructions and select sample prompts.</p>
<p>Choose from one of the
<a href="#supported-evaluation-metrics">supported evaluation metrics</a>, or define your
own custom evaluation metric. Custom metrics are useful when standard metrics
don't fit your application. You can optimize prompts using multiple metrics.
However, the Vertex AI prompt optimizer only supports one custom metric
at a time. For example, you could run the Vertex AI prompt optimizer
using a custom metric and the <code>bleu</code> metric, or with the <code>bleu</code>, <code>rouge</code>, and
<code>summarization_quality</code> metrics, but you can't run the Vertex AI prompt
optimizer with multiple custom metrics at once.</p>
<p><strong>Note:</strong> Custom metrics require you to deploy a Cloud Run function.
Cloud Run is a separate Google Cloud product with separate
<a href="/run/pricing">pricing</a>.</p>
<p>Create a custom metric by doing the following:</p>
<ol>
<li>Create a text file named <code>requirements.txt</code>.</li>
<li>In the <code>requirements.txt</code> file, define the required libraries for the custom
 evaluation metric function. All functions require the <code>functions-framework</code>
 package.</li>
</ol>
<p>For example, the <code>requirements.txt</code> file for a custom metric that computes
 ROUGE-L would look similar to the following:</p>
<p><div class="language-python highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="n">functions</span><span class="o">-</span><span class="n">framework</span><span class="o">==</span><span class="mf">3.</span><span class="o">*</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="n">rouge</span><span class="o">-</span><span class="n">score</span>
</span></code></pre></div>
3. Create a Python file named <code>main.py</code>.
4. In the <code>main.py</code> file, write your custom evaluation function. The function
 must accept the following:</p>
<ul>
<li>HTTP POST requests</li>
<li>JSON input that contains the <code>response</code>, which is the output from the LLM,
 and the <code>target</code>, which is the ground truth response for the prompt.</li>
</ul>
<p>For example, the <code>main.py</code> file for a custom metric that computes ROUGE-L
 would look similar to the following:</p>
<p><div class="language-python highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Any</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">functions_framework</span>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">rouge_score</span><span class="w"> </span><span class="kn">import</span> <span class="n">rouge_scorer</span>
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a>
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a><span class="c1"># Register an HTTP function with the Functions Framework</span>
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a><span class="nd">@functions_framework</span><span class="o">.</span><span class="n">http</span>
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
</span><span id="__span-12-9"><a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a><span class="n">request_json</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">get_json</span><span class="p">(</span><span class="n">silent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-12-10"><a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a><span class="k">if</span> <span class="ow">not</span> <span class="n">request_json</span><span class="p">:</span>
</span><span id="__span-12-11"><a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a><span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Can not find request json.&#39;</span><span class="p">)</span>
</span><span id="__span-12-12"><a id="__codelineno-12-12" name="__codelineno-12-12" href="#__codelineno-12-12"></a>
</span><span id="__span-12-13"><a id="__codelineno-12-13" name="__codelineno-12-13" href="#__codelineno-12-13"></a><span class="sd">&quot;&quot;&quot;Extract &#39;response&#39; and &#39;target&#39; from the request payload. &#39;response&#39;</span>
</span><span id="__span-12-14"><a id="__codelineno-12-14" name="__codelineno-12-14" href="#__codelineno-12-14"></a><span class="sd">represents the model&#39;s response, while &#39;target&#39; represents the ground</span>
</span><span id="__span-12-15"><a id="__codelineno-12-15" name="__codelineno-12-15" href="#__codelineno-12-15"></a><span class="sd">truth response.&quot;&quot;&quot;</span>
</span><span id="__span-12-16"><a id="__codelineno-12-16" name="__codelineno-12-16" href="#__codelineno-12-16"></a><span class="n">response</span> <span class="o">=</span> <span class="n">request_json</span><span class="p">[</span><span class="s1">&#39;response&#39;</span><span class="p">]</span>
</span><span id="__span-12-17"><a id="__codelineno-12-17" name="__codelineno-12-17" href="#__codelineno-12-17"></a><span class="n">reference</span> <span class="o">=</span> <span class="n">request_json</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]</span>
</span><span id="__span-12-18"><a id="__codelineno-12-18" name="__codelineno-12-18" href="#__codelineno-12-18"></a>
</span><span id="__span-12-19"><a id="__codelineno-12-19" name="__codelineno-12-19" href="#__codelineno-12-19"></a><span class="c1"># Compute ROUGE-L F-measure</span>
</span><span id="__span-12-20"><a id="__codelineno-12-20" name="__codelineno-12-20" href="#__codelineno-12-20"></a><span class="n">scorer</span> <span class="o">=</span> <span class="n">rouge_scorer</span><span class="o">.</span><span class="n">RougeScorer</span><span class="p">([</span><span class="s1">&#39;rougeL&#39;</span><span class="p">],</span> <span class="n">use_stemmer</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-12-21"><a id="__codelineno-12-21" name="__codelineno-12-21" href="#__codelineno-12-21"></a><span class="n">scores</span> <span class="o">=</span> <span class="n">scorer</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">reference</span><span class="p">,</span> <span class="n">response</span><span class="p">)</span>
</span><span id="__span-12-22"><a id="__codelineno-12-22" name="__codelineno-12-22" href="#__codelineno-12-22"></a><span class="n">final_score</span> <span class="o">=</span> <span class="n">scores</span><span class="p">[</span><span class="s1">&#39;rougeL&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fmeasure</span>
</span><span id="__span-12-23"><a id="__codelineno-12-23" name="__codelineno-12-23" href="#__codelineno-12-23"></a>
</span><span id="__span-12-24"><a id="__codelineno-12-24" name="__codelineno-12-24" href="#__codelineno-12-24"></a><span class="c1"># Return the custom score in the response</span>
</span><span id="__span-12-25"><a id="__codelineno-12-25" name="__codelineno-12-25" href="#__codelineno-12-25"></a><span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span>
</span><span id="__span-12-26"><a id="__codelineno-12-26" name="__codelineno-12-26" href="#__codelineno-12-26"></a><span class="c1"># The following key is the CUSTOM_METRIC_NAME that you pass to the job</span>
</span><span id="__span-12-27"><a id="__codelineno-12-27" name="__codelineno-12-27" href="#__codelineno-12-27"></a><span class="s1">&#39;custom_accuracy&#39;</span><span class="p">:</span> <span class="n">final_score</span><span class="p">,</span>
</span><span id="__span-12-28"><a id="__codelineno-12-28" name="__codelineno-12-28" href="#__codelineno-12-28"></a><span class="c1"># The following key is optional</span>
</span><span id="__span-12-29"><a id="__codelineno-12-29" name="__codelineno-12-29" href="#__codelineno-12-29"></a><span class="s1">&#39;explanation&#39;</span><span class="p">:</span> <span class="s1">&#39;ROUGE_L F-measure between reference and response&#39;</span><span class="p">,</span>
</span><span id="__span-12-30"><a id="__codelineno-12-30" name="__codelineno-12-30" href="#__codelineno-12-30"></a><span class="p">})</span>
</span></code></pre></div>
5. Deploy your custom evaluation function as a Cloud Run function by
 running the
 <a href="https://cloud.google.com/sdk/gcloud/reference/functions/deploy"><code>gcloud functions deploy</code> command</a>:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="n">gcloud</span> <span class="n">functions</span> <span class="n">deploy</span> <span class="n">FUNCTION_NAME</span> \
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="o">--</span><span class="n">project</span> <span class="n">PROJECT_ID</span> \
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="o">--</span><span class="n">gen2</span> \
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="o">--</span><span class="n">memory</span><span class="o">=</span><span class="mi">2</span><span class="n">Gb</span> \
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="o">--</span><span class="n">concurrency</span><span class="o">=</span><span class="mi">6</span> \
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a><span class="o">--</span><span class="nb">min</span><span class="o">-</span><span class="n">instances</span> <span class="mi">6</span> \
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a><span class="o">--</span><span class="n">region</span><span class="o">=</span><span class="n">REGION</span> \
</span><span id="__span-13-8"><a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a><span class="o">--</span><span class="n">runtime</span><span class="o">=</span><span class="s2">&quot;python310&quot;</span> \
</span><span id="__span-13-9"><a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a><span class="o">--</span><span class="n">source</span><span class="o">=</span><span class="s2">&quot;.&quot;</span> \
</span><span id="__span-13-10"><a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a><span class="o">--</span><span class="n">entry</span><span class="o">-</span><span class="n">point</span> <span class="n">main</span> \
</span><span id="__span-13-11"><a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a><span class="o">--</span><span class="n">trigger</span><span class="o">-</span><span class="n">http</span> \
</span><span id="__span-13-12"><a id="__codelineno-13-12" name="__codelineno-13-12" href="#__codelineno-13-12"></a><span class="o">--</span><span class="n">timeout</span><span class="o">=</span><span class="mi">3600</span> \
</span><span id="__span-13-13"><a id="__codelineno-13-13" name="__codelineno-13-13" href="#__codelineno-13-13"></a><span class="o">--</span><span class="n">quiet</span>
</span></code></pre></div>
<p>Replace the following:</p>
<ul>
<li><code>FUNCTION_NAME</code>: the name for the custom evaluation
 metric.</li>
<li><code>PROJECT_ID</code>: your project ID.</li>
<li><code>REGION</code>: the region where you want to deploy the
 function.</li>
</ul>
<h3 id="create-a-configuration">Create a configuration<a class="headerlink" href="#create-a-configuration" title="Permanent link">&para;</a></h3>
<p>The Vertex AI prompt optimizer configuration specifies the parameters
you want to set for your prompt optimization job, including the following:</p>
<ul>
<li>Optimization mode: specifies whether the Vertex AI prompt
 optimizer optimizes the system instructions, selects sample prompts to add to
 the system instructions as few shot examples, or both.</li>
<li>Evaluation metric: the metric that the Vertex AI prompt optimizer
 uses to optimize the system instructions and/or select sample prompts.</li>
<li>Target model: the
 <a href="../../models/">Google model</a> that the
 Vertex AI prompt optimizer optimizes the system instructions and/or
 selects sample prompts for use with.</li>
</ul>
<p>Create a configuration using one of the following options:</p>
<p><a href="#notebook">Notebook</a> <a href="#sdk">SDK</a> 
More</p>
<p>If you want to run the Vertex AI prompt optimizer through the
notebook, create a configuration by doing the following:</p>
<ol>
<li>In Colab Enterprise, open the Vertex AI prompt
 optimizer notebook.</li>
</ol>
<p><a href="https://console.cloud.google.com/vertex-ai/colab/notebooks">Go to Vertex AI prompt optimizer notebook</a>
2. In the <strong>Configure project settings</strong> section, do the following:</p>
<ol>
<li>In the <strong>PROJECT_ID</strong> field, enter your project ID.</li>
<li>In the <strong>LOCATION</strong> field, enter the location where you want to run the
 Vertex AI prompt optimizer.</li>
<li>In the <strong>OUTPUT_PATH</strong> field, enter the URI for the Cloud Storage
 bucket where you want the Vertex AI prompt optimizer
 to write the optimized system instructions and/or few shot examples.
 For example, <code>gs://bucket-name/output-path</code>.</li>
<li>In the <strong>INPUT_PATH</strong> field, enter the URI for the sample
 prompts in your Cloud Storage bucket. For example,
 <code>gs://bucket-name/sample-prompts.jsonl</code>.</li>
<li>
<p>In the <strong>Configure optimization settings</strong> section, do the following:</p>
</li>
<li>
<p>In the <strong>TARGET_MODEL</strong> field, enter the
 <a href="../../models/">model</a> that you want to optimize
 prompts for use with.</p>
</li>
<li>In the <strong>OPTIMIZATION_MODE</strong>, enter the optimization mode you want to
 use. Must be one of <code>instruction</code>, <code>demonstration</code>, or
 <code>instruction_and_demo</code>.</li>
<li>In the <strong>EVAL_METRIC</strong> field, enter the
 <a href="#supported-evaluation-metrics">evaluation metric</a> that you want to
 optimize your prompts for.</li>
<li>Optional: In the <strong>SOURCE_MODEL</strong> field, enter the
 <a href="../../models/">Google model</a> that the system
 instructions and prompts were previously used with. When the
 <code>source_model</code> parameter is set, the Vertex AI prompt
 optimizer runs your sample prompts on the source model to generate the
 ground truth responses for you, for evaluation metrics that require
 ground truth responses. If you didn't previously run your prompts with
 a Google model or you didn't achieve your target results, add ground
 truth responses to your prompt instead. For more information, see the
 <a href="#template-si">Create a prompt and system instructions</a> section of
 this document.</li>
<li>Optional: In the <strong>Configure advanced optimization settings</strong> section,
 you can additionally add any of the optional parameters to your
 configuration.</li>
</ol>
<p>View optional parameters</p>
<ul>
<li>In the <strong>NUM_INST_OPTIMIZATION_STEPS</strong> field, enter the number of
 iterations that the Vertex AI prompt optimizer uses in
 instruction optimization mode. The runtime increases linearly as you
 increase this value. Must be an integer between <code>10</code> and <code>20</code>. If left
 unset, the default is <code>10</code>.</li>
<li>In the <strong>NUM_TEMPLATES_PER_STEP</strong> field, enter the number of system
 instructions that the Vertex AI prompt optimizer generates
 and evaluates. Used with <code>instruction</code> and <code>instruction_and_demo</code>
 optimization mode. Must be an integer between <code>1</code> and <code>4</code>. If left
 unset, the default is <code>2</code>.</li>
<li>In the <strong>NUM_DEMO_OPTIMIZATION_STEPS</strong> field, enter the number of
 demonstrations that the Vertex AI prompt optimizer evaluates.
 Used with <code>demonstration</code> and <code>instruction_and_demo</code> optimization mode.
 Must be an integer between <code>10</code> and <code>30</code>. If left unset, the default is
 <code>10</code>.</li>
<li>In the <strong>NUM_DEMO_PER_PROMPT</strong> field, enter the number of
 demonstrations generated per prompt. Must be an integer between <code>3</code> and
 <code>6</code>. If left unset, the default is <code>3</code>.</li>
<li>In the <strong>TARGET_MODEL_QPS</strong> field, enter the queries per second (QPS)
 that the Vertex AI prompt optimizer sends to the target model.
 The runtime decreases linearly as you increase this value. Must be a
 float that is <code>3.0</code> or greater, but less than the QPS quota you have
 on the target model. If left unset, the default is <code>3.0</code>.</li>
<li>In the <strong>SOURCE_MODEL_QPS</strong> field, enter the queries per second
 (QPS) that the Vertex AI prompt optimizer sends to the
 source model. Must be a float that is <code>3.0</code> or greater, but less
 than the QPS quota you have on the source model. If left unset, the
 default is <code>3.0</code>.</li>
<li>In the <strong>EVAL_QPS</strong> field, enter the queries per second (QPS)
 that the Vertex AI prompt optimizer sends to the evaluation
 model, <code>gemini-1.5-pro</code>.</li>
<li>For model based metrics, must be a float that is <code>3.0</code> or
 greater, but less than the quota you have for
 <code>gemini-1.5-pro</code>. If left unset, the default is <code>3.0</code>.</li>
<li>For custom metrics, must be a float that is <code>3.0</code> or greater. This
 determines the rate at which the Vertex AI prompt
 optimizer calls your custom metric Cloud Run functions.</li>
<li>If you want to use more than one evaluation metric, do the following:</li>
<li>In the <strong>EVAL_METRIC_1</strong> field, enter an evaluation metric that you
 want to use.</li>
<li>In the <strong>EVAL_METRIC_1_WEIGHT</strong> field, enter the weight that you
 want the Vertex AI prompt optimizer to use when it runs
 the optimization.</li>
<li>In the <strong>EVAL_METRIC_2</strong> field, enter an evaluation metric that you
 want to use.</li>
<li>In the <strong>EVAL_METRIC_2_WEIGHT</strong> field, enter the weight that you
 want the Vertex AI prompt optimizer to use when it runs
 the optimization.</li>
<li>In the <strong>EVAL_METRIC_3</strong> field, optionally enter an evaluation
 metric that you want to use.</li>
<li>In the <strong>EVAL_METRIC_3_WEIGHT</strong> field, optionally enter</li>
<li>In the <strong>METRIC_AGGREGATION_TYPE</strong> field, enter the weight that you
 want the Vertex AI prompt optimizer to use when it runs
 the optimization.</li>
<li>In the <strong>PLACEHOLDER_TO_VALUE</strong> field, enter the information that
 replaces any variables in the system instructions. Information included
 within this flag is not optimized by the Vertex AI prompt
 optimizer.</li>
<li>In the <strong>RESPONSE_MIME_TYPE</strong> field, enter the
 <a href="https://cloud.google.com/vertex-ai/generative-ai/docs/samples/generativeaionvertexai-gemini-controlled-generation-response-schema">MIME response type</a>
 that the target model uses. Must be one of <code>text/plain</code> or
 <code>application/json</code>. If left unset, the default is <code>text/plain</code>.</li>
<li>In the <strong>TARGET_LANGUAGE</strong> field, enter the language of the system
 instructions. If left unset, the default is English.</li>
</ul>
<p>If you want to run the Vertex AI prompt optimizer through the
SDK, create a Create a JSON file with the parameters you want to use to
optimize prompts by doing the following:</p>
<ol>
<li>Create a JSON file with the parameters that you want to use to optimize
 your prompts. Each configuration file requires the following parameters:</li>
</ol>
<div class="language-python highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="p">{</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="s2">&quot;project&quot;</span><span class="p">:</span> <span class="s2">&quot;PROJECT_ID&quot;</span><span class="p">,</span>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="s2">&quot;system_instruction_path&quot;</span><span class="p">:</span> <span class="s2">&quot;SYSTEM_INSTRUCTION_PATH&quot;</span><span class="p">,</span>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="s2">&quot;prompt_template_path&quot;</span><span class="p">:</span> <span class="s2">&quot;PROMPT_TEMPLATE_PATH&quot;</span><span class="p">,</span>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="s2">&quot;target_model&quot;</span><span class="p">:</span> <span class="s2">&quot;TARGET_MODEL&quot;</span><span class="p">,</span>
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a><span class="n">EVALUATION_METRIC_PARAMETERS</span><span class="p">,</span>
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a><span class="s2">&quot;optimization_mode&quot;</span><span class="p">:</span> <span class="s2">&quot;OPTIMIZATION_MODE&quot;</span><span class="p">,</span>
</span><span id="__span-14-8"><a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a><span class="s2">&quot;input_data_path&quot;</span><span class="p">:</span> <span class="s2">&quot;SAMPLE_PROMPT_URI&quot;</span><span class="p">,</span>
</span><span id="__span-14-9"><a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a><span class="s2">&quot;output_path&quot;</span><span class="p">:</span> <span class="s2">&quot;OUTPUT_URI&quot;</span>
</span><span id="__span-14-10"><a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a><span class="p">}</span>
</span></code></pre></div>
<p>Replace the following:</p>
<ul>
<li><code>PROJECT_ID</code>: your project ID.</li>
<li><code>SYSTEM_INSTRUCTION_PATH</code>: the URI for the
 system instructions in your Cloud Storage bucket. For example,
 <code>gs://bucket-name/system-instruction.txt</code>.</li>
<li><code>PROMPT_TEMPLATE</code>: the URI for the
 prompt template in your Cloud Storage bucket. For example,
 <code>gs://bucket-name/prompt-template.txt</code></li>
<li><code>TARGET_MODEL</code>: the
 <a href="../../models/">model</a> that you want to optimize
 prompts for use with.</li>
<li><code>EVALUATION_METRIC_PARAMETERS</code>: the parameter(s)
 you specify depend on how many evaluation metrics you're using, and
 whether your metric(s) are standard or custom:</li>
</ul>
<p><a href="#single-standard-metric">Single standard metric</a> <a href="#single-custom-metric">Single custom metric</a> <a href="#multiple-standard-metrics">Multiple standard metrics</a> 
 More</p>
<p><a href="#multiple-standard--custom-metrics">Multiple standard &amp; custom metrics</a></p>
<p>If you're using a single
 <a href="#supported-evaluation-metrics">supported evaluation metric</a>,
 use the following parameter:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="s2">&quot;eval_metric&quot;</span><span class="p">:</span> <span class="s2">&quot;EVALUATION_METRIC&quot;</span><span class="p">,</span>
</span></code></pre></div>
<p>Replace <code>EVALUATION_METRIC</code> with the
 <a href="#supported-evaluation-metrics">evaluation metric</a> that you
 want to optimize your prompts for.</p>
<p>If you're using a single
 <a href="#evaluation-metric">custom evaluation metric</a>, use the
 following parameters:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="s2">&quot;eval_metric&quot;</span><span class="p">:</span> <span class="s2">&quot;custom_metric&quot;</span><span class="p">,</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="s2">&quot;custom_metric_name&quot;</span><span class="p">:</span> <span class="s2">&quot;CUSTOM_METRIC_NAME&quot;</span><span class="p">,</span>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="s2">&quot;custom_metric_cloud_function_name&quot;</span><span class="p">:</span> <span class="s2">&quot;FUNCTION_NAME&quot;</span><span class="p">,</span>
</span></code></pre></div>
<p>Replace the following:</p>
<ul>
<li><code>CUSTOM_METRIC_NAME</code>: the metric name, as defined
 by the key that corresponds with the <code>final_score</code>. For example,
 <code>custom_accuracy</code>.</li>
<li><code>FUNCTION_NAME</code>: the name of the
 Cloud Run function that you previously deployed.</li>
</ul>
<p>If you're using multiple
 <a href="#supported-evaluation-metrics">supported evaluation metrics</a>,
 use the following parameters:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="s2">&quot;eval_metrics_types&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">EVALUATION_METRIC_LIST</span><span class="p">],</span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="s2">&quot;eval_metrics_weights&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">EVAL_METRICS_WEIGHTS</span><span class="p">],</span>
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="s2">&quot;aggregation_type&quot;</span><span class="p">:</span> <span class="s2">&quot;METRIC_AGGREGATION_TYPE&quot;</span><span class="p">,</span>
</span></code></pre></div>
<p>Replace the following:</p>
<ul>
<li><code>EVALUATION_METRIC_LIST</code>: a list of
 evaluation metrics. Must be an array. For example,
 <code>"bleu", "summarization_quality"</code>.</li>
<li><code>EVAL_METRICS_WEIGHTS</code>: the weight for
 each metric. Must be an array.</li>
<li><code>METRIC_AGGREGATION_TYPE</code>: the type of
 aggregation used for the evaluation metrics. Must be one of
 <code>weighted_sum</code> or <code>weighted_average</code>. If left unset, the
 default is <code>weighted_sum</code>.</li>
</ul>
<p>If you're using multiple evaluation metrics that include a mix
 of a custom metric and standard metric(s), use the following
 parameters:</p>
<p><strong>Note:</strong> Only one of the metrics that you use can be a custom
 metric. The others must be standard metrics.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="s2">&quot;eval_metrics_types&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;custom_metric&quot;</span><span class="p">,</span> <span class="n">EVALUATION_METRIC_LIST</span><span class="p">],</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="s2">&quot;eval_metrics_weights&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">EVAL_METRICS_WEIGHTS</span><span class="p">],</span>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="s2">&quot;aggregation_type&quot;</span><span class="p">:</span> <span class="s2">&quot;METRIC_AGGREGATION_TYPE&quot;</span><span class="p">,</span>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a><span class="s2">&quot;custom_metric_name&quot;</span><span class="p">:</span> <span class="s2">&quot;CUSTOM_METRIC_NAME&quot;</span><span class="p">,</span>
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a><span class="s2">&quot;custom_metric_cloud_function_name&quot;</span><span class="p">:</span> <span class="s2">&quot;FUNCTION_NAME&quot;</span><span class="p">,</span>
</span></code></pre></div>
<p>Replace the following:</p>
<ul>
<li><code>EVALUATION_METRIC_LIST</code>: a list of
 the standard evaluation metrics. Must be an array. For
 example, <code>"bleu", "summarization_quality"</code>.</li>
<li><code>EVAL_METRICS_WEIGHTS</code>: the weight for
 each metric. Must be an array.</li>
<li><code>METRIC_AGGREGATION_TYPE</code>: the type of
 aggregation used for the evaluation metrics. Must be one of
 <code>weighted_sum</code> or <code>weighted_average</code>. If left unset, the
 default is <code>weighted_sum</code>.</li>
<li><code>CUSTOM_METRIC_NAME</code>: the metric name,
 as defined by the key that corresponds with the <code>final_score</code>.
 For example, <code>custom_accuracy</code>.</li>
<li><code>FUNCTION_NAME</code>: the name of the
 Cloud Run function that you previously deployed.</li>
<li><code>OPTIMIZATION_MODE</code>: the optimization mode. Must
 be one of <code>instruction</code>, <code>demonstration</code>, or <code>instruction_and_demo</code>.</li>
<li><code>SAMPLE_PROMPT_URI</code>: the URI for the sample
 prompts in your Cloud Storage bucket. For example,
 <code>gs://bucket-name/sample-prompts.jsonl</code>.</li>
<li><code>OUTPUT_URI</code>: the URI for the Cloud Storage
 bucket where you want the Vertex AI prompt optimizer
 to write the optimized system instructions and/or few shot examples.
 For example, <code>gs://bucket-name/output-path</code>.</li>
<li>You can additionally add any of the optional parameters to your
 configuration file.</li>
</ul>
<p>Optional parameters are broken down into 5 categories:</p>
<ul>
<li><strong>Optimization process parameters.</strong> These parameters control the
 overall optimization process, including its duration and the number of
 optimization iterations it runs, which directly impacts the quality of
 optimizations.</li>
<li><strong>Model selection and location parameters.</strong> These parameters specify
 which models the Vertex AI prompt optimizer uses and the
 locations it uses those models in.</li>
<li><strong>Latency (QPS) parameters.</strong> These parameters control QPS, impacting
 the speed of the optimization process.</li>
<li><strong>Other.</strong> Other parameters that control the structure and content of
 prompts.</li>
</ul>
<p>View optional parameters</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="s2">&quot;num_steps&quot;</span><span class="p">:</span> <span class="n">NUM_INST_OPTIMIZATION_STEPS</span><span class="p">,</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="s2">&quot;num_template_eval_per_step&quot;</span><span class="p">:</span> <span class="n">NUM_TEMPLATES_PER_STEP</span><span class="p">,</span>
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="s2">&quot;num_demo_set_candidates&quot;</span><span class="p">:</span> <span class="s2">&quot;NUM_DEMO_OPTIMIZATION_STEPS,</span>
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a><span class="s2">&quot;demo_set_size&quot;</span><span class="p">:</span> <span class="n">NUM_DEMO_PER_PROMPT</span><span class="p">,</span>
</span><span id="__span-19-5"><a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a><span class="s2">&quot;target_model_location&quot;</span><span class="p">:</span> <span class="s2">&quot;TARGET_MODEL_LOCATION&quot;</span><span class="p">,</span>
</span><span id="__span-19-6"><a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a><span class="s2">&quot;source_model&quot;</span><span class="p">:</span> <span class="s2">&quot;SOURCE_MODEL&quot;</span><span class="p">,</span>
</span><span id="__span-19-7"><a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a><span class="s2">&quot;source_model_location&quot;</span><span class="p">:</span> <span class="s2">&quot;SOURCE_MODEL_LOCATION&quot;</span><span class="p">,</span>
</span><span id="__span-19-8"><a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a><span class="s2">&quot;target_model_qps&quot;</span><span class="p">:</span> <span class="n">TARGET_MODEL_QPS</span><span class="p">,</span>
</span><span id="__span-19-9"><a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a><span class="s2">&quot;eval_qps&quot;</span><span class="p">:</span> <span class="n">EVAL_QPS</span><span class="p">,</span>
</span><span id="__span-19-10"><a id="__codelineno-19-10" name="__codelineno-19-10" href="#__codelineno-19-10"></a><span class="s2">&quot;source_model_qps&quot;</span><span class="p">:</span> <span class="n">SOURCE_MODEL_QPS</span><span class="p">,</span>
</span><span id="__span-19-11"><a id="__codelineno-19-11" name="__codelineno-19-11" href="#__codelineno-19-11"></a><span class="s2">&quot;response_mime_type&quot;</span><span class="p">:</span> <span class="s2">&quot;RESPONSE_MIME_TYPE&quot;</span><span class="p">,</span>
</span><span id="__span-19-12"><a id="__codelineno-19-12" name="__codelineno-19-12" href="#__codelineno-19-12"></a><span class="s2">&quot;language&quot;</span><span class="p">:</span> <span class="s2">&quot;TARGET_LANGUAGE&quot;</span><span class="p">,</span>
</span><span id="__span-19-13"><a id="__codelineno-19-13" name="__codelineno-19-13" href="#__codelineno-19-13"></a><span class="s2">&quot;placeholder_to_content&quot;</span><span class="p">:</span> <span class="s2">&quot;PLACEHOLDER_TO_CONTENT&quot;</span><span class="p">,</span>
</span><span id="__span-19-14"><a id="__codelineno-19-14" name="__codelineno-19-14" href="#__codelineno-19-14"></a><span class="s2">&quot;data_limit&quot;</span><span class="p">:</span> <span class="n">DATA_LIMIT</span>
</span></code></pre></div>
<p>Replace the following:</p>
<ul>
<li>
<p>Optimization process parameters:</p>
</li>
<li>
<p><code>NUM_INST_OPTIMIZATION_STEPS</code>: the number of
 iterations that the Vertex AI prompt optimizer uses in
 instruction optimization mode. The runtime increases linearly as you
 increase this value. Must be an integer between <code>10</code> and <code>20</code>. If
 left unset, the default is <code>10</code>.</p>
</li>
<li><code>NUM_TEMPLATES_PER_STEP</code>: the number of system
 instructions that the Vertex AI prompt optimizer generates
 and evaluates. Used with <code>instruction</code> and <code>instruction_and_demo</code>
 optimization mode. Must be an integer between <code>1</code> and <code>4</code>. If left
 unset, the default is <code>2</code>.</li>
<li><code>NUM_DEMO_OPTIMIZATION_STEPS</code>: the number of
 demonstrations that the Vertex AI prompt optimizer
 evaluates. Used with <code>demonstration</code> and <code>instruction_and_demo</code>
 optimization mode. Must be an integer between <code>10</code> and <code>30</code>. If left
 unset, the default is <code>10</code>.</li>
<li><code>NUM_DEMO_PER_PROMPT</code>: the number of
 demonstrations generated per prompt. Must be an integer between <code>3</code>
 and <code>6</code>. If left unset, the default is <code>3</code>.</li>
<li>
<p>Model selection and location parameters:</p>
</li>
<li>
<p><code>TARGET_MODEL_LOCATION</code>: the
 <a href="https://cloud.google.com/vertex-ai/generative-ai/docs/learn/locations">location</a> that you want to run
 the target model in. If left unset, the default is <code>us-central1</code>.</p>
</li>
<li><code>SOURCE_MODEL</code>: the
 <a href="../../models/">Google model</a> that the system
 instructions and prompts were previously used with. When the
 <code>source_model</code> parameter is set, the Vertex AI runs your
 sample prompts on the source model to generate the ground truth
 responses for you, for evaluation metrics that require ground truth
 responses. If you didn't previously run your prompts with a Google
 model or you didn't achieve your target results, add ground truth
 responses to your prompt instead. For more information, see the
 <a href="#template-si">Create a prompt and system instructions</a> section of
 this document.</li>
<li><code>SOURCE_MODEL_LOCATION</code>: the
 <a href="https://cloud.google.com/vertex-ai/generative-ai/docs/learn/locations">location</a> that you want to run
 the source model in. If left unset, the default is <code>us-central1</code>.</li>
<li>Latency (QPS) parameters:</li>
</ul>
<p><strong>Note:</strong> You must set a QPS that is lower than or equal to the QPM quota
 that is available to you, or your job will fail. To convert QPM quota
 to QPS, divide your QPM by 60. For example, a QPM quota of 600 is
 equivalent to a QPS of 600 (<code>600/10 = 60</code>).
 - <code>TARGET_MODEL_QPS</code>: the queries per second
 (QPS) that the Vertex AI prompt optimizer sends to the
 target model. The runtime decreases linearly as you increase this
 value. Must be a float that is <code>3.0</code> or greater, but less than the
 QPS quota you have on the target model. If left unset, the default is
 <code>3.0</code>.
 - <code>EVAL_QPS</code>: the queries per second (QPS)
 that the Vertex AI prompt optimizer sends to the evaluation
 model, <code>gemini-1.5-pro</code>.
 - For model based metrics, must be a float that is <code>3.0</code> or
 greater, but less than the quota you have for
 <code>gemini-1.5-pro</code>. If left unset, the default is <code>3.0</code>.
 - For custom metrics, must be a float that is <code>3.0</code> or greater. This
 determines the rate at which the Vertex AI prompt
 optimizer calls your custom metric Cloud Run functions.
 - <code>SOURCE_MODEL_QPS</code>: the queries per second
 (QPS) that the Vertex AI prompt optimizer sends to the
 source model. Must be a float that is <code>3.0</code> or greater, but less
 than the QPS quota you have on the source model. If left unset, the
 default is <code>3.0</code>.
 - Other parameters:</p>
<ul>
<li><code>RESPONSE_MIME_TYPE</code>: the
 <a href="https://cloud.google.com/vertex-ai/generative-ai/docs/samples/generativeaionvertexai-gemini-controlled-generation-response-schema">MIME response type</a>
 that the target model uses. Must be one of <code>text/plain</code> or
 <code>application/json</code>. If left unset, the default is <code>text/plain</code>.</li>
<li><code>TARGET_LANGUAGE</code>: the language of the system
 instructions. If left unset, the default is English.</li>
<li><code>PLACEHOLDER_TO_CONTENT</code>: the information that
 replaces any variables in the system instructions. Information
 included within this flag is not optimized by the Vertex AI
 prompt optimizer.</li>
<li><code>DATA_LIMIT</code>: the amount of data used for
 validation. The runtime increases linearly with this value. Must be
 an integer between <code>5</code> and <code>100</code>. If left unset, the default is <code>100</code>.</li>
<li><a href="https://cloud.google.com/storage/docs/uploading-objects">Upload the JSON file to a Cloud Storage bucket</a>.</li>
</ul>
<h3 id="run-prompt-optimizer">Run prompt optimizer<a class="headerlink" href="#run-prompt-optimizer" title="Permanent link">&para;</a></h3>
<p>Run the Vertex AI prompt optimizer using one of the following options:</p>
<p><a href="#notebook">Notebook</a><a href="#rest">REST</a><a href="#python">Python</a>
More</p>
<p>Run the Vertex AI prompt optimizer through the notebook, by
doing the following:</p>
<ol>
<li>In Colab Enterprise, open the Vertex AI prompt
 optimizer notebook.</li>
</ol>
<p><a href="https://console.cloud.google.com/vertex-ai/colab/notebooks">Go to Vertex AI prompt optimizer notebook</a>
2. In the <strong>Run prompt optimizer</strong> section, click
 play_circle <strong>Run
 cell</strong>.</p>
<p>The Vertex AI prompt optimizer runs.</p>
<p>Before using any of the request data,
make the following replacements:</p>
<ul>
<li>LOCATION: the location where you want to run the Vertex AI prompt
 optimizer.</li>
<li>PROJECT_ID: your <a href="https://cloud.google.com/resource-manager/docs/creating-managing-projects#identifiers">project ID</a>.</li>
<li>JOB_NAME: a name for the Vertex AI prompt optimizer job.</li>
<li>PATH_TO_CONFIG: the URI of the configuration file in your Cloud Storage bucket.
 For example, <code>gs://bucket-name/configuration.json</code>.</li>
</ul>
<p>HTTP method and URL:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="n">POST</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">LOCATION</span><span class="o">-</span><span class="n">aiplatform</span><span class="o">.</span><span class="n">googleapis</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">PROJECT_ID</span><span class="o">/</span><span class="n">locations</span><span class="o">/</span><span class="n">LOCATION</span><span class="o">/</span><span class="n">customJobs</span>
</span></code></pre></div>
<p>Request JSON body:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="p">{</span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a> <span class="s2">&quot;displayName&quot;</span><span class="p">:</span> <span class="s2">&quot;JOB_NAME&quot;</span><span class="p">,</span>
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a> <span class="s2">&quot;jobSpec&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a> <span class="s2">&quot;workerPoolSpecs&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span id="__span-21-5"><a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a> <span class="p">{</span>
</span><span id="__span-21-6"><a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a> <span class="s2">&quot;machineSpec&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-21-7"><a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a> <span class="s2">&quot;machineType&quot;</span><span class="p">:</span> <span class="s2">&quot;n1-standard-4&quot;</span>
</span><span id="__span-21-8"><a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a> <span class="p">},</span>
</span><span id="__span-21-9"><a id="__codelineno-21-9" name="__codelineno-21-9" href="#__codelineno-21-9"></a> <span class="s2">&quot;replicaCount&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="__span-21-10"><a id="__codelineno-21-10" name="__codelineno-21-10" href="#__codelineno-21-10"></a> <span class="s2">&quot;containerSpec&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-21-11"><a id="__codelineno-21-11" name="__codelineno-21-11" href="#__codelineno-21-11"></a> <span class="s2">&quot;imageUri&quot;</span><span class="p">:</span> <span class="s2">&quot;us-docker.pkg.dev/vertex-ai-restricted/builtin-algorithm/apd:preview_v1_0&quot;</span><span class="p">,</span>
</span><span id="__span-21-12"><a id="__codelineno-21-12" name="__codelineno-21-12" href="#__codelineno-21-12"></a> <span class="s2">&quot;args&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;--config=PATH_TO_CONFIG&quot;&quot;]</span>
</span><span id="__span-21-13"><a id="__codelineno-21-13" name="__codelineno-21-13" href="#__codelineno-21-13"></a> <span class="p">}</span>
</span><span id="__span-21-14"><a id="__codelineno-21-14" name="__codelineno-21-14" href="#__codelineno-21-14"></a> <span class="p">}</span>
</span><span id="__span-21-15"><a id="__codelineno-21-15" name="__codelineno-21-15" href="#__codelineno-21-15"></a> <span class="p">]</span>
</span><span id="__span-21-16"><a id="__codelineno-21-16" name="__codelineno-21-16" href="#__codelineno-21-16"></a> <span class="p">}</span>
</span><span id="__span-21-17"><a id="__codelineno-21-17" name="__codelineno-21-17" href="#__codelineno-21-17"></a><span class="p">}</span>
</span></code></pre></div>
<p>To send your request, choose one of these options:</p>
<p><a href="#curl">curl</a><a href="#powershell">PowerShell</a>
More</p>
<p><strong>Note:</strong>
The following command assumes that you have logged in to
the <code>gcloud</code> CLI with your user account by running
<a href="https://cloud.google.com/sdk/gcloud/reference/init"><code>gcloud init</code></a>
or
<a href="https://cloud.google.com/sdk/gcloud/reference/auth/login"><code>gcloud auth login</code></a>
, or by using <a href="https://cloud.google.com/shell/docs">Cloud Shell</a>,
which automatically logs you into the <code>gcloud</code> CLI
.
You can check the currently active account by running
<a href="https://cloud.google.com/sdk/gcloud/reference/auth/list"><code>gcloud auth list</code></a>.</p>
<p>Save the request body in a file named <code>request.json</code>,
and execute the following command:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="n">curl</span> <span class="o">-</span><span class="n">X</span> <span class="n">POST</span> \ 
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a> <span class="o">-</span><span class="n">H</span> <span class="s2">&quot;Authorization: Bearer $(gcloud auth print-access-token)&quot;</span> \ 
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a> <span class="o">-</span><span class="n">H</span> <span class="s2">&quot;Content-Type: application/json; charset=utf-8&quot;</span> \ 
</span><span id="__span-22-4"><a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a> <span class="o">-</span><span class="n">d</span> <span class="nd">@request</span><span class="o">.</span><span class="n">json</span> \ 
</span><span id="__span-22-5"><a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a> <span class="s2">&quot;https://LOCATION-aiplatform.googleapis.com/v1/projects/PROJECT_ID/locations/LOCATION/customJobs&quot;</span>
</span></code></pre></div>
<p><strong>Note:</strong>
The following command assumes that you have logged in to
the <code>gcloud</code> CLI with your user account by running
<a href="https://cloud.google.com/sdk/gcloud/reference/init"><code>gcloud init</code></a>
or
<a href="https://cloud.google.com/sdk/gcloud/reference/auth/login"><code>gcloud auth login</code></a>
.
You can check the currently active account by running
<a href="https://cloud.google.com/sdk/gcloud/reference/auth/list"><code>gcloud auth list</code></a>.</p>
<p>Save the request body in a file named <code>request.json</code>,
and execute the following command:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="err">$</span><span class="n">cred</span> <span class="o">=</span> <span class="n">gcloud</span> <span class="n">auth</span> <span class="nb">print</span><span class="o">-</span><span class="n">access</span><span class="o">-</span><span class="n">token</span> 
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="err">$</span><span class="n">headers</span> <span class="o">=</span> <span class="o">@</span><span class="p">{</span> <span class="s2">&quot;Authorization&quot;</span> <span class="o">=</span> <span class="s2">&quot;Bearer $cred&quot;</span> <span class="p">}</span> 
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a>
</span><span id="__span-23-4"><a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a><span class="n">Invoke</span><span class="o">-</span><span class="n">WebRequest</span> <span class="err">`</span> 
</span><span id="__span-23-5"><a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a> <span class="o">-</span><span class="n">Method</span> <span class="n">POST</span> <span class="err">`</span> 
</span><span id="__span-23-6"><a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a> <span class="o">-</span><span class="n">Headers</span> <span class="err">$</span><span class="n">headers</span> <span class="err">`</span> 
</span><span id="__span-23-7"><a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a> <span class="o">-</span><span class="n">ContentType</span><span class="p">:</span> <span class="s2">&quot;application/json; charset=utf-8&quot;</span> <span class="err">`</span> 
</span><span id="__span-23-8"><a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a> <span class="o">-</span><span class="n">InFile</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span> <span class="err">`</span> 
</span><span id="__span-23-9"><a id="__codelineno-23-9" name="__codelineno-23-9" href="#__codelineno-23-9"></a> <span class="o">-</span><span class="n">Uri</span> <span class="s2">&quot;https://LOCATION-aiplatform.googleapis.com/v1/projects/PROJECT_ID/locations/LOCATION/customJobs&quot;</span> <span class="o">|</span> <span class="n">Select</span><span class="o">-</span><span class="n">Object</span> <span class="o">-</span><span class="n">Expand</span> <span class="n">Content</span>
</span></code></pre></div>
<p>The response looks similar to the following:</p>
<h4 id="response">Response<a class="headerlink" href="#response" title="Permanent link">&para;</a></h4>
<div class="language-python highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="p">{</span>
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a> <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;projects/PROJECT_ID/locations/LOCATION/customJobs/JOB_ID&quot;</span><span class="p">,</span>
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a> <span class="s2">&quot;displayName&quot;</span><span class="p">:</span> <span class="s2">&quot;JOB_NAME&quot;</span><span class="p">,</span>
</span><span id="__span-24-4"><a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a> <span class="s2">&quot;jobSpec&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-24-5"><a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a> <span class="s2">&quot;workerPoolSpecs&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span id="__span-24-6"><a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a> <span class="p">{</span>
</span><span id="__span-24-7"><a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a> <span class="s2">&quot;machineSpec&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-24-8"><a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a> <span class="s2">&quot;machineType&quot;</span><span class="p">:</span> <span class="s2">&quot;n1-standard-4&quot;</span>
</span><span id="__span-24-9"><a id="__codelineno-24-9" name="__codelineno-24-9" href="#__codelineno-24-9"></a> <span class="p">},</span>
</span><span id="__span-24-10"><a id="__codelineno-24-10" name="__codelineno-24-10" href="#__codelineno-24-10"></a> <span class="s2">&quot;replicaCount&quot;</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span>
</span><span id="__span-24-11"><a id="__codelineno-24-11" name="__codelineno-24-11" href="#__codelineno-24-11"></a> <span class="s2">&quot;diskSpec&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-24-12"><a id="__codelineno-24-12" name="__codelineno-24-12" href="#__codelineno-24-12"></a> <span class="s2">&quot;bootDiskType&quot;</span><span class="p">:</span> <span class="s2">&quot;pd-ssd&quot;</span><span class="p">,</span>
</span><span id="__span-24-13"><a id="__codelineno-24-13" name="__codelineno-24-13" href="#__codelineno-24-13"></a> <span class="s2">&quot;bootDiskSizeGb&quot;</span><span class="p">:</span> <span class="mi">100</span>
</span><span id="__span-24-14"><a id="__codelineno-24-14" name="__codelineno-24-14" href="#__codelineno-24-14"></a> <span class="p">},</span>
</span><span id="__span-24-15"><a id="__codelineno-24-15" name="__codelineno-24-15" href="#__codelineno-24-15"></a> <span class="s2">&quot;containerSpec&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-24-16"><a id="__codelineno-24-16" name="__codelineno-24-16" href="#__codelineno-24-16"></a> <span class="s2">&quot;imageUri&quot;</span><span class="p">:</span> <span class="s2">&quot;us-docker.pkg.dev/vertex-ai-restricted/builtin-algorithm/apd:preview_v1_0&quot;</span>
</span><span id="__span-24-17"><a id="__codelineno-24-17" name="__codelineno-24-17" href="#__codelineno-24-17"></a> <span class="s2">&quot;args&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span id="__span-24-18"><a id="__codelineno-24-18" name="__codelineno-24-18" href="#__codelineno-24-18"></a> <span class="s2">&quot;--config=https://storage.mtls.cloud.google.com/testing-apd/testing-config.json&quot;</span>
</span><span id="__span-24-19"><a id="__codelineno-24-19" name="__codelineno-24-19" href="#__codelineno-24-19"></a> <span class="p">]</span>
</span><span id="__span-24-20"><a id="__codelineno-24-20" name="__codelineno-24-20" href="#__codelineno-24-20"></a> <span class="p">}</span>
</span><span id="__span-24-21"><a id="__codelineno-24-21" name="__codelineno-24-21" href="#__codelineno-24-21"></a> <span class="p">}</span>
</span><span id="__span-24-22"><a id="__codelineno-24-22" name="__codelineno-24-22" href="#__codelineno-24-22"></a> <span class="p">]</span>
</span><span id="__span-24-23"><a id="__codelineno-24-23" name="__codelineno-24-23" href="#__codelineno-24-23"></a> <span class="p">},</span>
</span><span id="__span-24-24"><a id="__codelineno-24-24" name="__codelineno-24-24" href="#__codelineno-24-24"></a> <span class="s2">&quot;state&quot;</span><span class="p">:</span> <span class="s2">&quot;JOB_STATE_PENDING&quot;</span><span class="p">,</span>
</span><span id="__span-24-25"><a id="__codelineno-24-25" name="__codelineno-24-25" href="#__codelineno-24-25"></a> <span class="s2">&quot;createTime&quot;</span><span class="p">:</span> <span class="s2">&quot;2020-09-15T19:09:54.342080Z&quot;</span><span class="p">,</span>
</span><span id="__span-24-26"><a id="__codelineno-24-26" name="__codelineno-24-26" href="#__codelineno-24-26"></a> <span class="s2">&quot;startTime&quot;</span><span class="p">:</span> <span class="s2">&quot;2020-09-15T19:13:42.991045Z&quot;</span><span class="p">,</span>
</span><span id="__span-24-27"><a id="__codelineno-24-27" name="__codelineno-24-27" href="#__codelineno-24-27"></a><span class="p">}</span>
</span></code></pre></div>
<p>Before trying this sample, follow the Python setup instructions in the
<a href="https://cloud.google.com/vertex-ai/docs/start/client-libraries">Vertex AI quickstart using
client libraries</a>.
For more information, see the
<a href="https://cloud.google.com/python/docs/reference/aiplatform/latest">Vertex AI Python API
reference documentation</a>.</p>
<p>To authenticate to Vertex AI, set up Application Default Credentials.
For more information, see
<a href="https://cloud.google.com/docs/authentication/set-up-adc-local-dev-environment">Set up authentication for a local development environment</a>.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">google.cloud</span><span class="w"> </span><span class="kn">import</span> <span class="n">aiplatform</span>
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a>
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a><span class="c1"># Initialize Vertex AI platform</span>
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a><span class="n">aiplatform</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">project</span><span class="o">=</span><span class="n">PROJECT_ID</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="s2">&quot;us-central1&quot;</span><span class="p">)</span>
</span><span id="__span-25-5"><a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a>
</span><span id="__span-25-6"><a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a><span class="c1"># TODO(Developer): Check and update lines below</span>
</span><span id="__span-25-7"><a id="__codelineno-25-7" name="__codelineno-25-7" href="#__codelineno-25-7"></a><span class="c1"># cloud_bucket = &quot;gs://cloud-samples-data&quot;</span>
</span><span id="__span-25-8"><a id="__codelineno-25-8" name="__codelineno-25-8" href="#__codelineno-25-8"></a><span class="c1"># config_path = f&quot;{cloud_bucket}/instructions/sample_configuration.json&quot;</span>
</span><span id="__span-25-9"><a id="__codelineno-25-9" name="__codelineno-25-9" href="#__codelineno-25-9"></a><span class="c1"># output_path = &quot;custom_job/output/&quot;</span>
</span><span id="__span-25-10"><a id="__codelineno-25-10" name="__codelineno-25-10" href="#__codelineno-25-10"></a>
</span><span id="__span-25-11"><a id="__codelineno-25-11" name="__codelineno-25-11" href="#__codelineno-25-11"></a><span class="n">custom_job</span> <span class="o">=</span> <span class="n">aiplatform</span><span class="o">.</span><span class="n">CustomJob</span><span class="p">(</span>
</span><span id="__span-25-12"><a id="__codelineno-25-12" name="__codelineno-25-12" href="#__codelineno-25-12"></a> <span class="n">display_name</span><span class="o">=</span><span class="s2">&quot;Prompt Optimizer example&quot;</span><span class="p">,</span>
</span><span id="__span-25-13"><a id="__codelineno-25-13" name="__codelineno-25-13" href="#__codelineno-25-13"></a> <span class="n">worker_pool_specs</span><span class="o">=</span><span class="p">[</span>
</span><span id="__span-25-14"><a id="__codelineno-25-14" name="__codelineno-25-14" href="#__codelineno-25-14"></a> <span class="p">{</span>
</span><span id="__span-25-15"><a id="__codelineno-25-15" name="__codelineno-25-15" href="#__codelineno-25-15"></a> <span class="s2">&quot;replica_count&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="__span-25-16"><a id="__codelineno-25-16" name="__codelineno-25-16" href="#__codelineno-25-16"></a> <span class="s2">&quot;container_spec&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-25-17"><a id="__codelineno-25-17" name="__codelineno-25-17" href="#__codelineno-25-17"></a> <span class="s2">&quot;image_uri&quot;</span><span class="p">:</span> <span class="s2">&quot;us-docker.pkg.dev/vertex-ai-restricted/builtin-algorithm/apd:preview_v1_0&quot;</span><span class="p">,</span>
</span><span id="__span-25-18"><a id="__codelineno-25-18" name="__codelineno-25-18" href="#__codelineno-25-18"></a> <span class="s2">&quot;args&quot;</span><span class="p">:</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;--config=</span><span class="si">{</span><span class="n">cloud_bucket</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">config_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">],</span>
</span><span id="__span-25-19"><a id="__codelineno-25-19" name="__codelineno-25-19" href="#__codelineno-25-19"></a> <span class="p">},</span>
</span><span id="__span-25-20"><a id="__codelineno-25-20" name="__codelineno-25-20" href="#__codelineno-25-20"></a> <span class="s2">&quot;machine_spec&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-25-21"><a id="__codelineno-25-21" name="__codelineno-25-21" href="#__codelineno-25-21"></a> <span class="s2">&quot;machine_type&quot;</span><span class="p">:</span> <span class="s2">&quot;n1-standard-4&quot;</span><span class="p">,</span>
</span><span id="__span-25-22"><a id="__codelineno-25-22" name="__codelineno-25-22" href="#__codelineno-25-22"></a> <span class="p">},</span>
</span><span id="__span-25-23"><a id="__codelineno-25-23" name="__codelineno-25-23" href="#__codelineno-25-23"></a> <span class="p">}</span>
</span><span id="__span-25-24"><a id="__codelineno-25-24" name="__codelineno-25-24" href="#__codelineno-25-24"></a> <span class="p">],</span>
</span><span id="__span-25-25"><a id="__codelineno-25-25" name="__codelineno-25-25" href="#__codelineno-25-25"></a> <span class="n">staging_bucket</span><span class="o">=</span><span class="n">cloud_bucket</span><span class="p">,</span>
</span><span id="__span-25-26"><a id="__codelineno-25-26" name="__codelineno-25-26" href="#__codelineno-25-26"></a> <span class="n">base_output_dir</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cloud_bucket</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">output_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="__span-25-27"><a id="__codelineno-25-27" name="__codelineno-25-27" href="#__codelineno-25-27"></a><span class="p">)</span>
</span><span id="__span-25-28"><a id="__codelineno-25-28" name="__codelineno-25-28" href="#__codelineno-25-28"></a>
</span><span id="__span-25-29"><a id="__codelineno-25-29" name="__codelineno-25-29" href="#__codelineno-25-29"></a><span class="n">custom_job</span><span class="o">.</span><span class="n">submit</span><span class="p">()</span>
</span><span id="__span-25-30"><a id="__codelineno-25-30" name="__codelineno-25-30" href="#__codelineno-25-30"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Job resource name: </span><span class="si">{</span><span class="n">custom_job</span><span class="o">.</span><span class="n">resource_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-25-31"><a id="__codelineno-25-31" name="__codelineno-25-31" href="#__codelineno-25-31"></a><span class="c1"># Example response:</span>
</span><span id="__span-25-32"><a id="__codelineno-25-32" name="__codelineno-25-32" href="#__codelineno-25-32"></a><span class="c1"># &#39;projects/123412341234/locations/us-central1/customJobs/12341234123412341234&#39;</span>
</span></code></pre></div>
<h3 id="analyze-results-and-iterate">Analyze results and iterate<a class="headerlink" href="#analyze-results-and-iterate" title="Permanent link">&para;</a></h3>
<p>After you run the Vertex AI prompt optimizer review the job's progress
using one of the following options:</p>
<p><a href="#notebook">Notebook</a> <a href="#console">Console</a> 
More</p>
<p>If you want to view the results of the Vertex AI prompt optimizer
through the notebook, do the following:</p>
<ol>
<li>Open the <a href="https://colab.sandbox.google.com/github/GoogleCloudPlatform/generative-ai/blob/main/gemini/prompts/prompt_optimizer/vertex_ai_prompt_optimizer_ui.ipynb">Vertex AI prompt optimizer notebook</a>.</li>
<li>
<p>In the <strong>Inspect the results</strong> section, do the following:</p>
</li>
<li>
<p>In the <strong>RESULT_PATH</strong> field, add the URI of the Cloud Storage
 bucket that you configured the Vertex AI prompt optimizer to
 write results to. For example, <code>gs://bucket-name/output-path</code>.</p>
</li>
<li>
<p>Click play_circle
 <strong>Run cell</strong>.</p>
</li>
<li>
<p>In the Google Cloud console, in the Vertex AI section, go
 to the <strong>Training pipelines</strong> page.</p>
</li>
</ol>
<p><a href="https://console.cloud.google.com/vertex-ai/training/training-pipelines">Go to Training pipelines</a>
2. Click the <strong>Custom jobs</strong> tab. Vertex AI prompt optimizer's
 custom training job appears in the list along with its status.</p>
<p>When the job is finished, review the optimizations by doing the following:</p>
<ol>
<li>In the Google Cloud console, go to the Cloud Storage <strong>Buckets</strong>
 page:</li>
</ol>
<p><a href="https://console.cloud.google.com/storage/browser">Go to Buckets</a>
2. Click the name of your Cloud Storage bucket.
3. Navigate to the folder that has the same name as the optimization mode
 you used to evaluate the prompts, either <code>instruction</code> or
 <code>demonstration</code>. If you used <code>instruction_and_demo</code> mode, both folders
 appear. The <code>instruction</code> folder contains the results from the system
 instruction optimization, while the <code>demonstration</code> folder contains the
 results from the <code>demonstration</code> optimization and the optimized system
 instructions.</p>
<p>The folder contains the following files:</p>
<ul>
<li><code>config.json</code>: the complete configuration that the Vertex AI
 prompt optimizer used.</li>
<li><code>templates.json</code>: each set of system instructions and/or few shot
 examples that the Vertex AI prompt optimizer generated and
 their evaluation score.</li>
<li><code>eval_results.json</code>: the target model's response for each sample prompt
 for each set of generated system instructions and/or few shot examples
 and their evaluation score.</li>
<li><code>optimized_results.json</code>: the best performing system instructions
 and/or few shot examples and their evaluation score.</li>
<li>To view the optimized system instructions, view the
 <code>optimized_results.json</code> file.</li>
</ul>
<h2 id="whats-next">What's next<a class="headerlink" href="#whats-next" title="Permanent link">&para;</a></h2>
<ul>
<li>Try the
 <a href="https://github.com/GoogleCloudPlatform/generative-ai/blob/main/gemini/prompts/prompt_optimizer/vertex_ai_prompt_optimizer_sdk.ipynb">Vertex AI prompt optimizer SDK notebook</a>.</li>
<li>Learn about
 <a href="https://cloud.google.com/vertex-ai/generative-ai/docs/learn/responsible-ai">responsible AI best practices and Vertex AI's safety filters</a>.</li>
<li>Learn more about
 <a href="https://cloud.google.com/vertex-ai/generative-ai/docs/learn/prompts/prompt-design-strategies">prompting strategies</a>.</li>
<li>Explore examples of prompts in the
 <a href="https://cloud.google.com/vertex-ai/generative-ai/docs/prompt-gallery">Prompt gallery</a>.</li>
</ul>
<p>Was this helpful?</p>







  
  






                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../../../models/Evaluate-Gen-AI-agents/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Evaluate Agents">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Evaluate Agents
              </div>
            </div>
          </a>
        
        
          
          <a href="../../../Retrieval-and-ranking/" class="md-footer__link md-footer__link--next" aria-label="Next: RAG Retrieval and Ranking">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                RAG Retrieval and Ranking
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../..", "features": ["content.code.annotate", "content.code.copy", "content.code.select", "content.tabs.link", "content.action.edit", "navigation.footer", "navigation.indexes", "navigation.instant", "navigation.instant.progress", "navigation.path", "navigation.top", "navigation.tracking", "toc.follow", "navigation.tabs", "navigation.sections", "navigation.tracking", "navigation.top", "search.suggest", "search.highlight"], "search": "../../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
        <script src="../../../js/chat-widget/gemini-client.js"></script>
      
        <script src="../../../js/chat-widget/init.js"></script>
      
        <script src="../../../js/chat-widget/setup-key.js"></script>
      
        <script src="../../../js/chat-widget-helper.js"></script>
      
    
  </body>
</html>